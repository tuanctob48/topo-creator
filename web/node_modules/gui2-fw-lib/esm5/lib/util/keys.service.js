/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/*
 * Copyright 2018-present Open Networking Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import * as d3 from 'd3';
import { LogService } from '../log.service';
import { FnService } from '../util/fn.service';
import { LionService } from './lion.service';
import { NavService } from '../nav/nav.service';
import * as i0 from "@angular/core";
import * as i1 from "../log.service";
import * as i2 from "./fn.service";
import * as i3 from "./lion.service";
import * as i4 from "../nav/nav.service";
/**
 * @record
 */
export function KeyHandler() { }
if (false) {
    /** @type {?} */
    KeyHandler.prototype.globalKeys;
    /** @type {?} */
    KeyHandler.prototype.maskedKeys;
    /** @type {?} */
    KeyHandler.prototype.dialogKeys;
    /** @type {?} */
    KeyHandler.prototype.viewKeys;
    /** @type {?} */
    KeyHandler.prototype.viewFn;
    /** @type {?} */
    KeyHandler.prototype.viewGestures;
}
/** @enum {string} */
var KeysToken = {
    KEYEV: 'keyev',
};
export { KeysToken };
/**
 * ONOS GUI -- Keys Service Module.
 */
var KeysService = /** @class */ (function () {
    function KeysService(log, fs, ls, ns) {
        this.log = log;
        this.fs = fs;
        this.ls = ls;
        this.ns = ns;
        this.enabled = true;
        this.globalEnabled = true;
        this.keyHandler = (/** @type {?} */ ({
            globalKeys: {},
            maskedKeys: {},
            dialogKeys: {},
            viewKeys: {},
            viewFn: null,
            viewGestures: [],
        }));
        this.seq = {};
        this.matching = false;
        this.matched = '';
        this.textFieldDoesNotBlock = {
            enter: 1,
            esc: 1,
        };
        this.quickHelpShown = false;
        this.log.debug('KeyService constructed');
    }
    /**
     * @param {?} elem
     * @return {?}
     */
    KeysService.prototype.installOn = /**
     * @param {?} elem
     * @return {?}
     */
    function (elem) {
        var _this = this;
        this.log.debug('Installing keys handler');
        elem.on('keydown', function () { _this.keyIn(); });
        this.setupGlobalKeys();
    };
    /**
     * @param {?} x
     * @return {?}
     */
    KeysService.prototype.keyBindings = /**
     * @param {?} x
     * @return {?}
     */
    function (x) {
        if (x === undefined) {
            return this.getKeyBindings();
        }
        else {
            this.setKeyBindings(x);
        }
    };
    /**
     * @return {?}
     */
    KeysService.prototype.unbindKeys = /**
     * @return {?}
     */
    function () {
        this.keyHandler.viewKeys = {};
        this.keyHandler.viewFn = null;
        this.keyHandler.viewGestures = [];
    };
    /**
     * @param {?} x
     * @return {?}
     */
    KeysService.prototype.dialogKeys = /**
     * @param {?} x
     * @return {?}
     */
    function (x) {
        if (x === undefined) {
            this.unbindDialogKeys();
        }
        else {
            this.bindDialogKeys(x);
        }
    };
    /**
     * @param {?} word
     * @param {?} data
     * @return {?}
     */
    KeysService.prototype.addSeq = /**
     * @param {?} word
     * @param {?} data
     * @return {?}
     */
    function (word, data) {
        this.fs.addToTrie(this.seq, word, data);
    };
    /**
     * @param {?} word
     * @return {?}
     */
    KeysService.prototype.remSeq = /**
     * @param {?} word
     * @return {?}
     */
    function (word) {
        this.fs.removeFromTrie(this.seq, word);
    };
    /**
     * @param {?=} g
     * @return {?}
     */
    KeysService.prototype.gestureNotes = /**
     * @param {?=} g
     * @return {?}
     */
    function (g) {
        if (g === undefined) {
            return this.keyHandler.viewGestures;
        }
        else {
            this.keyHandler.viewGestures = this.fs.isA(g) || [];
        }
    };
    /**
     * @param {?} b
     * @return {?}
     */
    KeysService.prototype.enableKeys = /**
     * @param {?} b
     * @return {?}
     */
    function (b) {
        this.enabled = b;
    };
    /**
     * @param {?} b
     * @return {?}
     */
    KeysService.prototype.enableGlobalKeys = /**
     * @param {?} b
     * @return {?}
     */
    function (b) {
        this.globalEnabled = b;
    };
    /**
     * @param {?} o
     * @return {?}
     */
    KeysService.prototype.checkNotGlobal = /**
     * @param {?} o
     * @return {?}
     */
    function (o) {
        var _this = this;
        /** @type {?} */
        var oops = [];
        if (this.fs.isO(o)) {
            o.forEach(function (val, key) {
                if (_this.keyHandler.globalKeys[key]) {
                    oops.push(key);
                }
            });
            if (oops.length) {
                this.log.warn('Ignoring reserved global key(s):', oops.join(','));
                oops.forEach(function (key) {
                    delete o[key];
                });
            }
        }
    };
    /**
     * @param {?} key
     * @return {?}
     */
    KeysService.prototype.matchSeq = /**
     * @param {?} key
     * @return {?}
     */
    function (key) {
        if (!this.matching && key === 'shift-shift') {
            this.matching = true;
            return true;
        }
        if (this.matching) {
            this.matched += key;
            this.lookup = this.fs.trieLookup(this.seq, this.matched);
            if (this.lookup === -1) {
                return true;
            }
            this.matching = false;
            this.matched = '';
            if (!this.lookup) {
                return;
            }
            // ee.cluck(lookup);
            return true;
        }
    };
    /**
     * @param {?} code
     * @return {?}
     */
    KeysService.prototype.whatKey = /**
     * @param {?} code
     * @return {?}
     */
    function (code) {
        switch (code) {
            case 8: return 'delete';
            case 9: return 'tab';
            case 13: return 'enter';
            case 16: return 'shift';
            case 27: return 'esc';
            case 32: return 'space';
            case 37: return 'leftArrow';
            case 38: return 'upArrow';
            case 39: return 'rightArrow';
            case 40: return 'downArrow';
            case 186: return 'semicolon';
            case 187: return 'equals';
            case 188: return 'comma';
            case 189: return 'dash';
            case 190: return 'dot';
            case 191: return 'slash';
            case 192: return 'backQuote';
            case 219: return 'openBracket';
            case 220: return 'backSlash';
            case 221: return 'closeBracket';
            case 222: return 'quote';
            default:
                if ((code >= 48 && code <= 57) ||
                    (code >= 65 && code <= 90)) {
                    return String.fromCharCode(code);
                }
                else if (code >= 112 && code <= 123) {
                    return 'F' + (code - 111);
                }
                return null;
        }
    };
    /**
     * @return {?}
     */
    KeysService.prototype.textFieldInput = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var t = d3.event.target.tagName.toLowerCase();
        return t === 'input' || t === 'textarea';
    };
    /**
     * @return {?}
     */
    KeysService.prototype.keyIn = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var event = d3.event;
        // d3.events can set the keyCode, but unit tests based on KeyboardEvent
        // cannot set keyCode since the attribute has been deprecated
        /** @type {?} */
        var code = event.keyCode ? event.keyCode : event.code;
        /** @type {?} */
        var key = this.whatKey(Number.parseInt(code));
        this.log.debug('Key detected', event, key, event.code, event.keyCode);
        /** @type {?} */
        var textBlockable = !this.textFieldDoesNotBlock[key];
        /** @type {?} */
        var modifiers = [];
        if (event.metaKey) {
            modifiers.push('cmd');
        }
        if (event.altKey) {
            modifiers.push('alt');
        }
        if (event.shiftKey) {
            modifiers.push('shift');
        }
        if (!key) {
            return;
        }
        modifiers.push(key);
        key = modifiers.join('-');
        if (textBlockable && this.textFieldInput()) {
            return;
        }
        /** @type {?} */
        var kh = this.keyHandler;
        /** @type {?} */
        var gk = kh.globalKeys[key];
        /** @type {?} */
        var gcb = this.fs.isF(gk) || (this.fs.isA(gk) && this.fs.isF(gk[0]));
        /** @type {?} */
        var dk = kh.dialogKeys[key];
        /** @type {?} */
        var dcb = this.fs.isF(dk);
        /** @type {?} */
        var vk = kh.viewKeys[key];
        /** @type {?} */
        var kl = this.fs.isF(kh.viewKeys._keyListener);
        /** @type {?} */
        var vcb = this.fs.isF(vk) || (this.fs.isA(vk) && this.fs.isF(vk[0])) || this.fs.isF(kh.viewFn);
        /** @type {?} */
        var token = KeysToken.KEYEV;
        event.stopPropagation();
        if (this.enabled) {
            if (this.matchSeq(key)) {
                return;
            }
            // global callback?
            if (gcb && gcb(token, key, code, event)) {
                // if the event was 'handled', we are done
                return;
            }
            // dialog callback?
            if (dcb) {
                dcb(token, key, code, event);
                // assume dialog handled the event
                return;
            }
            // otherwise, let the view callback have a shot
            if (vcb) {
                this.log.debug('Letting view callback have a shot', vcb, token, key, code, event);
                vcb(token, key, code, event);
            }
            if (kl) {
                kl(key);
            }
        }
    };
    // functions to obtain localized strings deferred from the setup of the
    //  global key data structures.
    // functions to obtain localized strings deferred from the setup of the
    //  global key data structures.
    /**
     * @return {?}
     */
    KeysService.prototype.qhlion = 
    // functions to obtain localized strings deferred from the setup of the
    //  global key data structures.
    /**
     * @return {?}
     */
    function () {
        return this.ls.bundle('core.fw.QuickHelp');
    };
    /**
     * @return {?}
     */
    KeysService.prototype.qhlionShowHide = /**
     * @return {?}
     */
    function () {
        return this.qhlion()('qh_hint_show_hide_qh');
    };
    /**
     * @return {?}
     */
    KeysService.prototype.qhlionHintEsc = /**
     * @return {?}
     */
    function () {
        return this.qhlion()('qh_hint_esc');
    };
    /**
     * @return {?}
     */
    KeysService.prototype.qhlionHintT = /**
     * @return {?}
     */
    function () {
        return this.qhlion()('qh_hint_t');
    };
    /**
     * @return {?}
     */
    KeysService.prototype.setupGlobalKeys = /**
     * @return {?}
     */
    function () {
        var _this = this;
        Object.assign(this.keyHandler, {
            globalKeys: {
                backSlash: [function (view, key, code, ev) { return _this.quickHelp(view, key, code, ev); }, this.qhlionShowHide],
                slash: [function (view, key, code, ev) { return _this.quickHelp(view, key, code, ev); }, this.qhlionShowHide],
                esc: [function (view, key, code, ev) { return _this.escapeKey(view, key, code, ev); }, this.qhlionHintEsc],
                T: [function (view, key, code, ev) { return _this.toggleTheme(view, key, code, ev); }, this.qhlionHintT],
            },
            globalFormat: ['backSlash', 'slash', 'esc', 'T'],
            // Masked keys are global key handlers that always return true.
            // That is, the view will never see the event for that key.
            maskedKeys: {
                slash: 1,
                backSlash: 1,
                T: 1,
            },
        });
    };
    /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    KeysService.prototype.quickHelp = /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    function (view, key, code, ev) {
        if (!this.globalEnabled) {
            return false;
        }
        this.quickHelpShown = !this.quickHelpShown;
        return true;
    };
    // returns true if we 'consumed' the ESC keypress, false otherwise
    // returns true if we 'consumed' the ESC keypress, false otherwise
    /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    KeysService.prototype.escapeKey = 
    // returns true if we 'consumed' the ESC keypress, false otherwise
    /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    function (view, key, code, ev) {
        this.quickHelpShown = false;
        return this.ns.hideNav();
    };
    /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    KeysService.prototype.toggleTheme = /**
     * @param {?} view
     * @param {?} key
     * @param {?} code
     * @param {?} ev
     * @return {?}
     */
    function (view, key, code, ev) {
        if (!this.globalEnabled) {
            return false;
        }
        // ts.toggleTheme();
        return true;
    };
    /**
     * @param {?} map
     * @param {?} caller
     * @param {?} remove
     * @return {?}
     */
    KeysService.prototype.filterMaskedKeys = /**
     * @param {?} map
     * @param {?} caller
     * @param {?} remove
     * @return {?}
     */
    function (map, caller, remove) {
        var _this = this;
        /** @type {?} */
        var masked = [];
        /** @type {?} */
        var msgs = [];
        d3.map(map).keys().forEach(function (key) {
            if (_this.keyHandler.maskedKeys[key]) {
                masked.push(key);
                msgs.push(caller, ': Key "' + key + '" is reserved');
            }
        });
        if (msgs.length) {
            this.log.warn(msgs.join('\n'));
        }
        if (remove) {
            masked.forEach(function (k) {
                delete map[k];
            });
        }
        return masked;
    };
    /**
     * @param {?} fname
     * @param {?} x
     * @return {?}
     */
    KeysService.prototype.unexParam = /**
     * @param {?} fname
     * @param {?} x
     * @return {?}
     */
    function (fname, x) {
        this.log.warn(fname, ': unexpected parameter-- ', x);
    };
    /**
     * @param {?} keyArg
     * @return {?}
     */
    KeysService.prototype.setKeyBindings = /**
     * @param {?} keyArg
     * @return {?}
     */
    function (keyArg) {
        /** @type {?} */
        var fname = 'setKeyBindings()';
        /** @type {?} */
        var kFunc = this.fs.isF(keyArg);
        /** @type {?} */
        var kMap = this.fs.isO(keyArg);
        if (kFunc) {
            // set general key handler callback
            this.keyHandler.viewFn = kFunc;
        }
        else if (kMap) {
            this.filterMaskedKeys(kMap, fname, true);
            this.keyHandler.viewKeys = kMap;
        }
        else {
            this.unexParam(fname, keyArg);
        }
    };
    /**
     * @return {?}
     */
    KeysService.prototype.getKeyBindings = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var gkeys = d3.map(this.keyHandler.globalKeys).keys();
        /** @type {?} */
        var masked = d3.map(this.keyHandler.maskedKeys).keys();
        /** @type {?} */
        var vkeys = d3.map(this.keyHandler.viewKeys).keys();
        /** @type {?} */
        var vfn = !!this.fs.isF(this.keyHandler.viewFn);
        return {
            globalKeys: gkeys,
            maskedKeys: masked,
            viewKeys: vkeys,
            viewFunction: vfn,
        };
    };
    /**
     * @param {?} map
     * @return {?}
     */
    KeysService.prototype.bindDialogKeys = /**
     * @param {?} map
     * @return {?}
     */
    function (map) {
        /** @type {?} */
        var fname = 'bindDialogKeys()';
        /** @type {?} */
        var kMap = this.fs.isO(map);
        if (kMap) {
            this.filterMaskedKeys(map, fname, true);
            this.keyHandler.dialogKeys = kMap;
        }
        else {
            this.unexParam(fname, map);
        }
    };
    /**
     * @return {?}
     */
    KeysService.prototype.unbindDialogKeys = /**
     * @return {?}
     */
    function () {
        this.keyHandler.dialogKeys = {};
    };
    KeysService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root',
                },] },
    ];
    /** @nocollapse */
    KeysService.ctorParameters = function () { return [
        { type: LogService },
        { type: FnService },
        { type: LionService },
        { type: NavService }
    ]; };
    /** @nocollapse */ KeysService.ngInjectableDef = i0.defineInjectable({ factory: function KeysService_Factory() { return new KeysService(i0.inject(i1.LogService), i0.inject(i2.FnService), i0.inject(i3.LionService), i0.inject(i4.NavService)); }, token: KeysService, providedIn: "root" });
    return KeysService;
}());
export { KeysService };
if (false) {
    /** @type {?} */
    KeysService.prototype.enabled;
    /** @type {?} */
    KeysService.prototype.globalEnabled;
    /** @type {?} */
    KeysService.prototype.keyHandler;
    /** @type {?} */
    KeysService.prototype.seq;
    /** @type {?} */
    KeysService.prototype.matching;
    /** @type {?} */
    KeysService.prototype.matched;
    /** @type {?} */
    KeysService.prototype.lookup;
    /** @type {?} */
    KeysService.prototype.textFieldDoesNotBlock;
    /** @type {?} */
    KeysService.prototype.quickHelpShown;
    /** @type {?} */
    KeysService.prototype.log;
    /** @type {?} */
    KeysService.prototype.fs;
    /** @type {?} */
    KeysService.prototype.ls;
    /** @type {?} */
    KeysService.prototype.ns;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5cy5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vZ3VpMi1mdy1saWIvIiwic291cmNlcyI6WyJsaWIvdXRpbC9rZXlzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWVBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxLQUFLLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDekIsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG9CQUFvQixDQUFDOzs7Ozs7Ozs7QUFFaEQsZ0NBT0M7OztJQU5HLGdDQUFtQjs7SUFDbkIsZ0NBQW1COztJQUNuQixnQ0FBbUI7O0lBQ25CLDhCQUFjOztJQUNkLDRCQUFZOztJQUNaLGtDQUF5Qjs7OztJQUl6QixPQUFRLE9BQU87Ozs7OztBQU1uQjtJQXlCSSxxQkFDYyxHQUFlLEVBQ2YsRUFBYSxFQUNiLEVBQWUsRUFDZixFQUFjO1FBSGQsUUFBRyxHQUFILEdBQUcsQ0FBWTtRQUNmLE9BQUUsR0FBRixFQUFFLENBQVc7UUFDYixPQUFFLEdBQUYsRUFBRSxDQUFhO1FBQ2YsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQXpCNUIsWUFBTyxHQUFZLElBQUksQ0FBQztRQUN4QixrQkFBYSxHQUFZLElBQUksQ0FBQztRQUM5QixlQUFVLEdBQWUsbUJBQVk7WUFDakMsVUFBVSxFQUFFLEVBQUU7WUFDZCxVQUFVLEVBQUUsRUFBRTtZQUNkLFVBQVUsRUFBRSxFQUFFO1lBQ2QsUUFBUSxFQUFFLEVBQUU7WUFDWixNQUFNLEVBQUUsSUFBSTtZQUNaLFlBQVksRUFBRSxFQUFFO1NBQ25CLEVBQUEsQ0FBQztRQUVGLFFBQUcs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Q2xCLEtBQUssR0FBRyxrQkFBa0I7O1lBQzFCLElBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFFN0IsSUFBSSxJQUFJLEVBQUU7WUFDTixJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDckM7YUFBTTtZQUNILElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQzlCO0lBQ0wsQ0FBQzs7OztJQUVTLHNDQUFnQjs7O0lBQTFCO1FBQ0ksSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3BDLENBQUM7O2dCQTNXSixVQUFVLFNBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCOzs7O2dCQXZCUSxVQUFVO2dCQUNWLFNBQVM7Z0JBQ1QsV0FBVztnQkFDWCxVQUFVOzs7c0JBcEJuQjtDQW1aQyxBQTdXRCxJQTZXQztTQTFXWSxXQUFXOzs7SUFDcEIsOEJBQXdCOztJQUN4QixvQ0FBOEI7O0lBQzlCLGlDQU9FOztJQUVGLDBCQUFjOztJQUNkLCtCQUEwQjs7SUFDMUIsOEJBQXFCOztJQUNyQiw2QkFBWTs7SUFDWiw0Q0FHRTs7SUFDRixxQ0FBZ0M7O0lBRzVCLDBCQUF5Qjs7SUFDekIseUJBQXVCOztJQUN2Qix5QkFBeUI7O0lBQ3pCLHlCQUF3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC1wcmVzZW50IE9wZW4gTmV0d29ya2luZyBGb3VuZGF0aW9uXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm5TZXJ2aWNlIH0gZnJvbSAnLi4vdXRpbC9mbi5zZXJ2aWNlJztcbmltcG9ydCB7IExpb25TZXJ2aWNlIH0gZnJvbSAnLi9saW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmF2U2VydmljZSB9IGZyb20gJy4uL25hdi9uYXYuc2VydmljZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgS2V5SGFuZGxlciB7XG4gICAgZ2xvYmFsS2V5czogT2JqZWN0O1xuICAgIG1hc2tlZEtleXM6IE9iamVjdDtcbiAgICBkaWFsb2dLZXlzOiBPYmplY3Q7XG4gICAgdmlld0tleXM6IGFueTtcbiAgICB2aWV3Rm46IGFueTtcbiAgICB2aWV3R2VzdHVyZXM6IHN0cmluZ1tdW107XG59XG5cbmV4cG9ydCBlbnVtIEtleXNUb2tlbiB7XG4gICAgS0VZRVYgPSAna2V5ZXYnXG59XG5cbi8qKlxuICogT05PUyBHVUkgLS0gS2V5cyBTZXJ2aWNlIE1vZHVsZS5cbiAqL1xuQEluamVjdGFibGUoe1xuICAgIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgS2V5c1NlcnZpY2Uge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGdsb2JhbEVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICAgIGtleUhhbmRsZXI6IEtleUhhbmRsZXIgPSA8S2V5SGFuZGxlcj57XG4gICAgICAgIGdsb2JhbEtleXM6IHt9LFxuICAgICAgICBtYXNrZWRLZXlzOiB7fSxcbiAgICAgICAgZGlhbG9nS2V5czoge30sXG4gICAgICAgIHZpZXdLZXlzOiB7fSxcbiAgICAgICAgdmlld0ZuOiBudWxsLFxuICAgICAgICB2aWV3R2VzdHVyZXM6IFtdLFxuICAgIH07XG5cbiAgICBzZXE6IGFueSA9IHt9O1xuICAgIG1hdGNoaW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgbWF0Y2hlZDogc3RyaW5nID0gJyc7XG4gICAgbG9va3VwOiBhbnk7XG4gICAgdGV4dEZpZWxkRG9lc05vdEJsb2NrOiBhbnkgPSB7XG4gICAgICAgIGVudGVyOiAxLFxuICAgICAgICBlc2M6IDEsXG4gICAgfTtcbiAgICBxdWlja0hlbHBTaG93bjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByb3RlY3RlZCBsb2c6IExvZ1NlcnZpY2UsXG4gICAgICAgIHByb3RlY3RlZCBmczogRm5TZXJ2aWNlLFxuICAgICAgICBwcm90ZWN0ZWQgbHM6IExpb25TZXJ2aWNlLFxuICAgICAgICBwcm90ZWN0ZWQgbnM6IE5hdlNlcnZpY2VcbiAgICApIHtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoJ0tleVNlcnZpY2UgY29uc3RydWN0ZWQnKTtcbiAgICB9XG5cbiAgICBpbnN0YWxsT24oZWxlbSkge1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnSW5zdGFsbGluZyBrZXlzIGhhbmRsZXInKTtcbiAgICAgICAgZWxlbS5vbigna2V5ZG93bicsICgpID0+IHsgdGhpcy5rZXlJbigpOyB9KTtcbiAgICAgICAgdGhpcy5zZXR1cEdsb2JhbEtleXMoKTtcbiAgICB9XG5cbiAgICBrZXlCaW5kaW5ncyh4KSB7XG4gICAgICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEtleUJpbmRpbmdzKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldEtleUJpbmRpbmdzKHgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdW5iaW5kS2V5cygpIHtcbiAgICAgICAgdGhpcy5rZXlIYW5kbGVyLnZpZXdLZXlzID0ge307XG4gICAgICAgIHRoaXMua2V5SGFuZGxlci52aWV3Rm4gPSBudWxsO1xuICAgICAgICB0aGlzLmtleUhhbmRsZXIudmlld0dlc3R1cmVzID0gW107XG4gICAgfVxuXG4gICAgZGlhbG9nS2V5cyh4KSB7XG4gICAgICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudW5iaW5kRGlhbG9nS2V5cygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5iaW5kRGlhbG9nS2V5cyh4KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFkZFNlcSh3b3JkLCBkYXRhKSB7XG4gICAgICAgIHRoaXMuZnMuYWRkVG9UcmllKHRoaXMuc2VxLCB3b3JkLCBkYXRhKTtcbiAgICB9XG5cbiAgICByZW1TZXEod29yZCkge1xuICAgICAgICB0aGlzLmZzLnJlbW92ZUZyb21UcmllKHRoaXMuc2VxLCB3b3JkKTtcbiAgICB9XG5cbiAgICBnZXN0dXJlTm90ZXMoZz8pIHtcbiAgICAgICAgaWYgKGcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMua2V5SGFuZGxlci52aWV3R2VzdHVyZXM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmtleUhhbmRsZXIudmlld0dlc3R1cmVzID0gdGhpcy5mcy5pc0EoZykgfHwgW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBlbmFibGVLZXlzKGIpIHtcbiAgICAgICAgdGhpcy5lbmFibGVkID0gYjtcbiAgICB9XG5cbiAgICBlbmFibGVHbG9iYWxLZXlzKGIpIHtcbiAgICAgICAgdGhpcy5nbG9iYWxFbmFibGVkID0gYjtcbiAgICB9XG5cbiAgICBjaGVja05vdEdsb2JhbChvKSB7XG4gICAgICAgIGNvbnN0IG9vcHMgPSBbXTtcbiAgICAgICAgaWYgKHRoaXMuZnMuaXNPKG8pKSB7XG4gICAgICAgICAgICBvLmZvckVhY2goKHZhbCwga2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMua2V5SGFuZGxlci5nbG9iYWxLZXlzW2tleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgb29wcy5wdXNoKGtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAob29wcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZy53YXJuKCdJZ25vcmluZyByZXNlcnZlZCBnbG9iYWwga2V5KHMpOicsIG9vcHMuam9pbignLCcpKTtcbiAgICAgICAgICAgICAgICBvb3BzLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb1trZXldO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG1hdGNoU2VxKGtleSkge1xuICAgICAgICBpZiAoIXRoaXMubWF0Y2hpbmcgJiYga2V5ID09PSAnc2hpZnQtc2hpZnQnKSB7XG4gICAgICAgICAgICB0aGlzLm1hdGNoaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1hdGNoaW5nKSB7XG4gICAgICAgICAgICB0aGlzLm1hdGNoZWQgKz0ga2V5O1xuICAgICAgICAgICAgdGhpcy5sb29rdXAgPSB0aGlzLmZzLnRyaWVMb29rdXAodGhpcy5zZXEsIHRoaXMubWF0Y2hlZCk7XG4gICAgICAgICAgICBpZiAodGhpcy5sb29rdXAgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm1hdGNoaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm1hdGNoZWQgPSAnJztcbiAgICAgICAgICAgIGlmICghdGhpcy5sb29rdXApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlZS5jbHVjayhsb29rdXApO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgd2hhdEtleShjb2RlOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgODogcmV0dXJuICdkZWxldGUnO1xuICAgICAgICAgICAgY2FzZSA5OiByZXR1cm4gJ3RhYic7XG4gICAgICAgICAgICBjYXNlIDEzOiByZXR1cm4gJ2VudGVyJztcbiAgICAgICAgICAgIGNhc2UgMTY6IHJldHVybiAnc2hpZnQnO1xuICAgICAgICAgICAgY2FzZSAyNzogcmV0dXJuICdlc2MnO1xuICAgICAgICAgICAgY2FzZSAzMjogcmV0dXJuICdzcGFjZSc7XG4gICAgICAgICAgICBjYXNlIDM3OiByZXR1cm4gJ2xlZnRBcnJvdyc7XG4gICAgICAgICAgICBjYXNlIDM4OiByZXR1cm4gJ3VwQXJyb3cnO1xuICAgICAgICAgICAgY2FzZSAzOTogcmV0dXJuICdyaWdodEFycm93JztcbiAgICAgICAgICAgIGNhc2UgNDA6IHJldHVybiAnZG93bkFycm93JztcbiAgICAgICAgICAgIGNhc2UgMTg2OiByZXR1cm4gJ3NlbWljb2xvbic7XG4gICAgICAgICAgICBjYXNlIDE4NzogcmV0dXJuICdlcXVhbHMnO1xuICAgICAgICAgICAgY2FzZSAxODg6IHJldHVybiAnY29tbWEnO1xuICAgICAgICAgICAgY2FzZSAxODk6IHJldHVybiAnZGFzaCc7XG4gICAgICAgICAgICBjYXNlIDE5MDogcmV0dXJuICdkb3QnO1xuICAgICAgICAgICAgY2FzZSAxOTE6IHJldHVybiAnc2xhc2gnO1xuICAgICAgICAgICAgY2FzZSAxOTI6IHJldHVybiAnYmFja1F1b3RlJztcbiAgICAgICAgICAgIGNhc2UgMjE5OiByZXR1cm4gJ29wZW5CcmFja2V0JztcbiAgICAgICAgICAgIGNhc2UgMjIwOiByZXR1cm4gJ2JhY2tTbGFzaCc7XG4gICAgICAgICAgICBjYXNlIDIyMTogcmV0dXJuICdjbG9zZUJyYWNrZXQnO1xuICAgICAgICAgICAgY2FzZSAyMjI6IHJldHVybiAncXVvdGUnO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoKGNvZGUgPj0gNDggJiYgY29kZSA8PSA1NykgfHxcbiAgICAgICAgICAgICAgICAgICAgKGNvZGUgPj0gNjUgJiYgY29kZSA8PSA5MCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlID49IDExMiAmJiBjb2RlIDw9IDEyMykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ0YnICsgKGNvZGUgLSAxMTEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCB0ZXh0RmllbGRJbnB1dCgpIHtcbiAgICAgICAgY29uc3QgdCA9IGQzLmV2ZW50LnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHJldHVybiB0ID09PSAnaW5wdXQnIHx8IHQgPT09ICd0ZXh0YXJlYSc7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGtleUluKCkge1xuICAgICAgICBjb25zdCBldmVudCA9IGQzLmV2ZW50O1xuICAgICAgICAvLyBkMy5ldmVudHMgY2FuIHNldCB0aGUga2V5Q29kZSwgYnV0IHVuaXQgdGVzdHMgYmFzZWQgb24gS2V5Ym9hcmRFdmVudFxuICAgICAgICAvLyBjYW5ub3Qgc2V0IGtleUNvZGUgc2luY2UgdGhlIGF0dHJpYnV0ZSBoYXMgYmVlbiBkZXByZWNhdGVkXG4gICAgICAgIGNvbnN0IGNvZGUgPSBldmVudC5rZXlDb2RlID8gZXZlbnQua2V5Q29kZSA6IGV2ZW50LmNvZGU7XG4gICAgICAgIGxldCBrZXkgPSB0aGlzLndoYXRLZXkoTnVtYmVyLnBhcnNlSW50KGNvZGUpKTtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoJ0tleSBkZXRlY3RlZCcsIGV2ZW50LCBrZXksIGV2ZW50LmNvZGUsIGV2ZW50LmtleUNvZGUpO1xuICAgICAgICBjb25zdCB0ZXh0QmxvY2thYmxlID0gIXRoaXMudGV4dEZpZWxkRG9lc05vdEJsb2NrW2tleV07XG4gICAgICAgIGNvbnN0IG1vZGlmaWVycyA9IFtdO1xuXG4gICAgICAgIGlmIChldmVudC5tZXRhS2V5KSB7XG4gICAgICAgICAgICBtb2RpZmllcnMucHVzaCgnY21kJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LmFsdEtleSkge1xuICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ2FsdCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgbW9kaWZpZXJzLnB1c2goJ3NoaWZ0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWtleSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbW9kaWZpZXJzLnB1c2goa2V5KTtcbiAgICAgICAga2V5ID0gbW9kaWZpZXJzLmpvaW4oJy0nKTtcblxuICAgICAgICBpZiAodGV4dEJsb2NrYWJsZSAmJiB0aGlzLnRleHRGaWVsZElucHV0KCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtoOiBLZXlIYW5kbGVyID0gdGhpcy5rZXlIYW5kbGVyO1xuICAgICAgICBjb25zdCBnayA9IGtoLmdsb2JhbEtleXNba2V5XTtcbiAgICAgICAgY29uc3QgZ2NiID0gdGhpcy5mcy5pc0YoZ2spIHx8ICh0aGlzLmZzLmlzQShnaykgJiYgdGhpcy5mcy5pc0YoZ2tbMF0pKTtcbiAgICAgICAgY29uc3QgZGsgPSBraC5kaWFsb2dLZXlzW2tleV07XG4gICAgICAgIGNvbnN0IGRjYiA9IHRoaXMuZnMuaXNGKGRrKTtcbiAgICAgICAgY29uc3QgdmsgPSBraC52aWV3S2V5c1trZXldO1xuICAgICAgICBjb25zdCBrbCA9IHRoaXMuZnMuaXNGKGtoLnZpZXdLZXlzLl9rZXlMaXN0ZW5lcik7XG4gICAgICAgIGNvbnN0IHZjYiA9IHRoaXMuZnMuaXNGKHZrKSB8fCAodGhpcy5mcy5pc0EodmspICYmIHRoaXMuZnMuaXNGKHZrWzBdKSkgfHwgdGhpcy5mcy5pc0Yoa2gudmlld0ZuKTtcbiAgICAgICAgY29uc3QgdG9rZW46IEtleXNUb2tlbiA9IEtleXNUb2tlbi5LRVlFVjsgLy8gaW5kaWNhdGUgdGhpcyB3YXMgYSBrZXktcHJlc3NlZCBldmVudFxuXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoU2VxKGtleSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGdsb2JhbCBjYWxsYmFjaz9cbiAgICAgICAgICAgIGlmIChnY2IgJiYgZ2NiKHRva2VuLCBrZXksIGNvZGUsIGV2ZW50KSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBldmVudCB3YXMgJ2hhbmRsZWQnLCB3ZSBhcmUgZG9uZVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRpYWxvZyBjYWxsYmFjaz9cbiAgICAgICAgICAgIGlmIChkY2IpIHtcbiAgICAgICAgICAgICAgICBkY2IodG9rZW4sIGtleSwgY29kZSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIC8vIGFzc3VtZSBkaWFsb2cgaGFuZGxlZCB0aGUgZXZlbnRcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBvdGhlcndpc2UsIGxldCB0aGUgdmlldyBjYWxsYmFjayBoYXZlIGEgc2hvdFxuICAgICAgICAgICAgaWYgKHZjYikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKCdMZXR0aW5nIHZpZXcgY2FsbGJhY2sgaGF2ZSBhIHNob3QnLCB2Y2IsIHRva2VuLCBrZXksIGNvZGUsIGV2ZW50ICk7XG4gICAgICAgICAgICAgICAgdmNiKHRva2VuLCBrZXksIGNvZGUsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChrbCkge1xuICAgICAgICAgICAgICAgIGtsKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBmdW5jdGlvbnMgdG8gb2J0YWluIGxvY2FsaXplZCBzdHJpbmdzIGRlZmVycmVkIGZyb20gdGhlIHNldHVwIG9mIHRoZVxuICAgIC8vICBnbG9iYWwga2V5IGRhdGEgc3RydWN0dXJlcy5cbiAgICBwcm90ZWN0ZWQgcWhsaW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5scy5idW5kbGUoJ2NvcmUuZncuUXVpY2tIZWxwJyk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBxaGxpb25TaG93SGlkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucWhsaW9uKCkoJ3FoX2hpbnRfc2hvd19oaWRlX3FoJyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHFobGlvbkhpbnRFc2MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnFobGlvbigpKCdxaF9oaW50X2VzYycpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBxaGxpb25IaW50VCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucWhsaW9uKCkoJ3FoX2hpbnRfdCcpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzZXR1cEdsb2JhbEtleXMoKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcy5rZXlIYW5kbGVyLCB7XG4gICAgICAgICAgICBnbG9iYWxLZXlzOiB7XG4gICAgICAgICAgICAgICAgYmFja1NsYXNoOiBbKHZpZXcsIGtleSwgY29kZSwgZXYpID0+IHRoaXMucXVpY2tIZWxwKHZpZXcsIGtleSwgY29kZSwgZXYpLCB0aGlzLnFobGlvblNob3dIaWRlXSxcbiAgICAgICAgICAgICAgICBzbGFzaDogWyh2aWV3LCBrZXksIGNvZGUsIGV2KSA9PiB0aGlzLnF1aWNrSGVscCh2aWV3LCBrZXksIGNvZGUsIGV2KSwgdGhpcy5xaGxpb25TaG93SGlkZV0sXG4gICAgICAgICAgICAgICAgZXNjOiBbKHZpZXcsIGtleSwgY29kZSwgZXYpID0+IHRoaXMuZXNjYXBlS2V5KHZpZXcsIGtleSwgY29kZSwgZXYpLCB0aGlzLnFobGlvbkhpbnRFc2NdLFxuICAgICAgICAgICAgICAgIFQ6IFsodmlldywga2V5LCBjb2RlLCBldikgPT4gdGhpcy50b2dnbGVUaGVtZSh2aWV3LCBrZXksIGNvZGUsIGV2KSwgdGhpcy5xaGxpb25IaW50VF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2xvYmFsRm9ybWF0OiBbJ2JhY2tTbGFzaCcsICdzbGFzaCcsICdlc2MnLCAnVCddLFxuXG4gICAgICAgICAgICAvLyBNYXNrZWQga2V5cyBhcmUgZ2xvYmFsIGtleSBoYW5kbGVycyB0aGF0IGFsd2F5cyByZXR1cm4gdHJ1ZS5cbiAgICAgICAgICAgIC8vIFRoYXQgaXMsIHRoZSB2aWV3IHdpbGwgbmV2ZXIgc2VlIHRoZSBldmVudCBmb3IgdGhhdCBrZXkuXG4gICAgICAgICAgICBtYXNrZWRLZXlzOiB7XG4gICAgICAgICAgICAgICAgc2xhc2g6IDEsXG4gICAgICAgICAgICAgICAgYmFja1NsYXNoOiAxLFxuICAgICAgICAgICAgICAgIFQ6IDEsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgcXVpY2tIZWxwKHZpZXcsIGtleSwgY29kZSwgZXYpIHtcbiAgICAgICAgaWYgKCF0aGlzLmdsb2JhbEVuYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnF1aWNrSGVscFNob3duID0gIXRoaXMucXVpY2tIZWxwU2hvd247XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIHJldHVybnMgdHJ1ZSBpZiB3ZSAnY29uc3VtZWQnIHRoZSBFU0Mga2V5cHJlc3MsIGZhbHNlIG90aGVyd2lzZVxuICAgIHByb3RlY3RlZCBlc2NhcGVLZXkodmlldywga2V5LCBjb2RlLCBldikge1xuICAgICAgICB0aGlzLnF1aWNrSGVscFNob3duID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0aGlzLm5zLmhpZGVOYXYoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdG9nZ2xlVGhlbWUodmlldywga2V5LCBjb2RlLCBldikge1xuICAgICAgICBpZiAoIXRoaXMuZ2xvYmFsRW5hYmxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRzLnRvZ2dsZVRoZW1lKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBmaWx0ZXJNYXNrZWRLZXlzKG1hcDogYW55LCBjYWxsZXI6IGFueSwgcmVtb3ZlOiBib29sZWFuKTogYW55W10ge1xuICAgICAgICBjb25zdCBtYXNrZWQgPSBbXTtcbiAgICAgICAgY29uc3QgbXNncyA9IFtdO1xuXG4gICAgICAgIGQzLm1hcChtYXApLmtleXMoKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmtleUhhbmRsZXIubWFza2VkS2V5c1trZXldKSB7XG4gICAgICAgICAgICAgICAgbWFza2VkLnB1c2goa2V5KTtcbiAgICAgICAgICAgICAgICBtc2dzLnB1c2goY2FsbGVyLCAnOiBLZXkgXCInICsga2V5ICsgJ1wiIGlzIHJlc2VydmVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChtc2dzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5sb2cud2Fybihtc2dzLmpvaW4oJ1xcbicpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgICAgIG1hc2tlZC5mb3JFYWNoKChrKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG1hcFtrXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtYXNrZWQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHVuZXhQYXJhbShmbmFtZSwgeCkge1xuICAgICAgICB0aGlzLmxvZy53YXJuKGZuYW1lLCAnOiB1bmV4cGVjdGVkIHBhcmFtZXRlci0tICcsIHgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzZXRLZXlCaW5kaW5ncyhrZXlBcmcpIHtcbiAgICAgICAgY29uc3QgZm5hbWUgPSAnc2V0S2V5QmluZGluZ3MoKSc7XG4gICAgICAgIGNvbnN0IGtGdW5jID0gdGhpcy5mcy5pc0Yoa2V5QXJnKTtcbiAgICAgICAgY29uc3Qga01hcCA9IHRoaXMuZnMuaXNPKGtleUFyZyk7XG5cbiAgICAgICAgaWYgKGtGdW5jKSB7XG4gICAgICAgICAgICAvLyBzZXQgZ2VuZXJhbCBrZXkgaGFuZGxlciBjYWxsYmFja1xuICAgICAgICAgICAgdGhpcy5rZXlIYW5kbGVyLnZpZXdGbiA9IGtGdW5jO1xuICAgICAgICB9IGVsc2UgaWYgKGtNYXApIHtcbiAgICAgICAgICAgIHRoaXMuZmlsdGVyTWFza2VkS2V5cyhrTWFwLCBmbmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmtleUhhbmRsZXIudmlld0tleXMgPSBrTWFwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51bmV4UGFyYW0oZm5hbWUsIGtleUFyZyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRLZXlCaW5kaW5ncygpIHtcbiAgICAgICAgY29uc3QgZ2tleXMgPSBkMy5tYXAodGhpcy5rZXlIYW5kbGVyLmdsb2JhbEtleXMpLmtleXMoKTtcbiAgICAgICAgY29uc3QgbWFza2VkID0gZDMubWFwKHRoaXMua2V5SGFuZGxlci5tYXNrZWRLZXlzKS5rZXlzKCk7XG4gICAgICAgIGNvbnN0IHZrZXlzID0gZDMubWFwKHRoaXMua2V5SGFuZGxlci52aWV3S2V5cykua2V5cygpO1xuICAgICAgICBjb25zdCB2Zm4gPSAhIXRoaXMuZnMuaXNGKHRoaXMua2V5SGFuZGxlci52aWV3Rm4pO1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnbG9iYWxLZXlzOiBna2V5cyxcbiAgICAgICAgICAgIG1hc2tlZEtleXM6IG1hc2tlZCxcbiAgICAgICAgICAgIHZpZXdLZXlzOiB2a2V5cyxcbiAgICAgICAgICAgIHZpZXdGdW5jdGlvbjogdmZuLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBiaW5kRGlhbG9nS2V5cyhtYXApIHtcbiAgICAgICAgY29uc3QgZm5hbWUgPSAnYmluZERpYWxvZ0tleXMoKSc7XG4gICAgICAgIGNvbnN0IGtNYXAgPSB0aGlzLmZzLmlzTyhtYXApO1xuXG4gICAgICAgIGlmIChrTWFwKSB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlck1hc2tlZEtleXMobWFwLCBmbmFtZSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmtleUhhbmRsZXIuZGlhbG9nS2V5cyA9IGtNYXA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVuZXhQYXJhbShmbmFtZSwgbWFwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCB1bmJpbmREaWFsb2dLZXlzKCkge1xuICAgICAgICB0aGlzLmtleUhhbmRsZXIuZGlhbG9nS2V5cyA9IHt9O1xuICAgIH1cblxufVxuIl19