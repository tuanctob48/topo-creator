/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/*
 * Copyright 2018-present Open Networking Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, Inject, NgZone } from '@angular/core';
import { Router } from '@angular/router';
import { LionService } from '../../util/lion.service';
import { LogService } from '../../log.service';
import { NavService } from '../../nav/nav.service';
import { WebSocketService } from '../../remote/websocket.service';
/**
 * ONOS GUI -- Masthead Component
 */
var MastComponent = /** @class */ (function () {
    function MastComponent(lion, log, ns, wss, router, zone, window) {
        this.lion = lion;
        this.log = log;
        this.ns = ns;
        this.wss = wss;
        this.router = router;
        this.zone = zone;
        this.window = window;
        // Function
        this.viewMap = new Map([]); // A map of app names
        // A map of app names
        this.confirmMessage = '';
        this.strongWarning = '';
        this.viewMap.set('apps', 'https://wiki.onosproject.org/display/ONOS/GUI+Application+View');
        this.viewMap.set('device', 'https://wiki.onosproject.org/display/ONOS/GUI+Device+View');
        this.viewMap.set('', 'https://wiki.onosproject.org/display/ONOS/The+ONOS+Web+GUI');
    }
    /**
     * @return {?}
     */
    MastComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.lion.ubercache.length === 0) {
            this.lionFn = this.dummyLion;
            this.lion.loadCbs.set('mast', function () { return _this.doLion(); });
            this.log.debug('LION not available when MastComponent initialized');
        }
        else {
            this.doLion();
        }
        this.wss.bindHandlers(new Map([
            ['guiRemoved', function (data) { return _this.triggerRefresh(data, false); }],
            ['guiAdded', function (data) { return _this.triggerRefresh(data, true); }]
        ]));
        this.log.debug('MastComponent initialized');
    };
    /**
     * Nav component should never be closed, but in case it does, it's
     * safer to tidy up after itself
     */
    /**
     * Nav component should never be closed, but in case it does, it's
     * safer to tidy up after itself
     * @return {?}
     */
    MastComponent.prototype.ngOnDestroy = /**
     * Nav component should never be closed, but in case it does, it's
     * safer to tidy up after itself
     * @return {?}
     */
    function () {
        this.lion.loadCbs.delete('mast');
    };
    /**
    * Read the LION bundle for App and set up the lionFn
    */
    /**
     * Read the LION bundle for App and set up the lionFn
     * @return {?}
     */
    MastComponent.prototype.doLion = /**
     * Read the LION bundle for App and set up the lionFn
     * @return {?}
     */
    function () {
        this.lionFn = this.lion.bundle('core.fw.Mast');
        if (this.username === undefined) {
            this.username = this.lionFn('unknown_user');
        }
    };
    /**
    * A dummy implementation of the lionFn until the response is received and the LION
    * bundle is received from the WebSocket
    */
    /**
     * A dummy implementation of the lionFn until the response is received and the LION
     * bundle is received from the WebSocket
     * @param {?} key
     * @return {?}
     */
    MastComponent.prototype.dummyLion = /**
     * A dummy implementation of the lionFn until the response is received and the LION
     * bundle is received from the WebSocket
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return '%' + key + '%';
    };
    /**
     * @return {?}
     */
    MastComponent.prototype.directTo = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var curId = this.window.location.pathname.replace('/', '');
        /** @type {?} */
        var helpUrl = this.viewMap.get(curId);
        if (helpUrl === undefined) {
            helpUrl = this.viewMap.get('');
            this.log.warn('No help file linked for view:', curId);
        }
        this.window.open(helpUrl);
    };
    /**
     * @param {?} data
     * @param {?} added
     * @return {?}
     */
    MastComponent.prototype.triggerRefresh = /**
     * @param {?} data
     * @param {?} added
     * @return {?}
     */
    function (data, added) {
        this.confirmMessage = this.lionFn(added ? 'uicomp_added' : 'uicomp_removed');
        this.log.debug('Refresh has been triggered - item', added ? 'added' : 'removed', ' - ', data);
    };
    /**
     * Callback when the Confirm dialog is shown and a choice is made
     */
    /**
     * Callback when the Confirm dialog is shown and a choice is made
     * @param {?} choice
     * @return {?}
     */
    MastComponent.prototype.dOk = /**
     * Callback when the Confirm dialog is shown and a choice is made
     * @param {?} choice
     * @return {?}
     */
    function (choice) {
        if (choice) {
            this.ns.getUiViews();
            this.router.navigate(['/']);
            this.zone.runOutsideAngular(function () {
                location.reload();
            });
            this.log.debug('Refresh confirmed'); // Will not be printed if page reloads
        }
        else {
            this.log.debug('Refresh cancelled');
        }
        this.confirmMessage = '';
        this.strongWarning = '';
    };
    MastComponent.decorators = [
        { type: Component, args: [{
                    selector: 'onos-mast',
                    template: "<!--\n~ Copyright 2018-present Open Networking Foundation\n~\n~ Licensed under the Apache License, Version 2.0 (the \"License\");\n~ you may not use this file except in compliance with the License.\n~ You may obtain a copy of the License at\n~\n~     http://www.apache.org/licenses/LICENSE-2.0\n~\n~ Unless required by applicable law or agreed to in writing, software\n~ distributed under the License is distributed on an \"AS IS\" BASIS,\n~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n~ See the License for the specific language governing permissions and\n~ limitations under the License.\n-->\n<div id=\"mast-top-block\"></div>\n<!-- The mast-top-block is an inline display element that pushes any\n  subsequent elements down the page. It has a height of 48px\n     The mast block overlays the mast-top-block. It is is positioned\n     absolutely so that the nav component can slide in behind it when\n     not shown -->\n<div id=\"mast\" align=\"left\">\n    <span class=\"nav-menu-button clickable\" (click)=\"ns.toggleNav()\">\n        <img src=\"data/img/nav-menu-mojo.png\"/>\n    </span>\n    <img class=\"logo\" src=\"data/img/masthead-logo-mojo.png\">\n    <onos-confirm title=\"{{ lionFn('ui_ok_to_update') }}\" message=\"{{ confirmMessage }}\" warning=\"{{ strongWarning }}\" (chosen)=\"dOk($event)\"></onos-confirm>\n    <div id=\"mast-right\">\n        <nav>\n            <div class=\"dropdown-parent\">\n                <a class=\"clickable user-menu__name\">{{ username }} <i class=\"dropdown-icon\"></i></a>\n                <div class=\"dropdown\">\n                    <a href=\"rs/logout\"> {{ lionFn('logout') }} </a>\n                </div>\n            </div>\n            <div class=\"ctrl-btns\">\n                <div class=\"active clickable icon\" (click)=\"directTo()\">\n                    <onos-icon iconId=\"query\" iconSize=\"32\" toolTip=\"{{ lionFn('tt_help') }}\"></onos-icon>\n                </div>\n            </div>\n        </nav>\n\n    </div>\n</div>\n",
                    styles: ["#mast-top-block{display:block;z-index:-1;height:48px;width:100%}#mast{position:absolute;width:100%;top:0;height:48px;padding:0;z-index:10000}#mast a:hover{text-decoration:none}html[data-platform=iPad] #mast{padding-top:16px}#mast .nav-menu-button{display:inline-block;vertical-align:middle;text-align:center;line-height:48px;padding:0 12px;cursor:pointer;cursor:hand;font-size:0}#mast .nav-menu-button img{width:25px;vertical-align:middle}#mast .logo{height:47px;width:511px;vertical-align:bottom}#mast-right{display:inline-block;float:right;position:relative;top:0;padding-right:15px;line-height:48px}#mast-right div.ctrl-btns{float:right}#mast-right div.icon{box-sizing:border-box;position:relative;height:48px;width:48px;padding:9px}#mast .dropdown-parent{position:relative;float:right}#mast .dropdown-parent i.dropdown-icon{display:inline-block;height:7px;width:9px;margin-left:10px;background:url(data/img/dropdown-icon.png) no-repeat}#mast .dropdown{position:absolute;top:40px;right:-8px;display:none;min-width:100px;line-height:16px;font-size:12pt;z-index:1000}#mast .dropdown a{text-decoration:none;font-size:12px;display:block;padding:8px 16px 6px 12px}#mast .dropdown-parent:hover .dropdown{display:block}#mast .dropdown-parent:hover i.dropdown-icon{background-position-x:-14px}html[data-platform=iPad] #mast .dropdown{top:57px}", "#mast{background-color:#231f20}#mast .nav-menu-button:hover{background-color:#888}#mast nav,#mast-right a{color:#009fdb}#mast .dropdown{background-color:#231f20;border:1px solid #ddd}#mast .dropdown a{color:#009fdb;border-bottom:1px solid #444}#mast .dropdown a:hover{color:#fff}"]
                },] },
    ];
    /** @nocollapse */
    MastComponent.ctorParameters = function () { return [
        { type: LionService },
        { type: LogService },
        { type: NavService },
        { type: WebSocketService },
        { type: Router },
        { type: NgZone },
        { type: undefined, decorators: [{ type: Inject, args: ['Window',] }] }
    ]; };
    MastComponent.propDecorators = {
        username: [{ type: Input }]
    };
    return MastComponent;
}());
export { MastComponent };
if (false) {
    /** @type {?} */
    MastComponent.prototype.username;
    /** @type {?} */
    MastComponent.prototype.lionFn;
    /** @type {?} */
    MastComponent.prototype.viewMap;
    /** @type {?} */
    MastComponent.prototype.confirmMessage;
    /** @type {?} */
    MastComponent.prototype.strongWarning;
    /** @type {?} */
    MastComponent.prototype.lion;
    /** @type {?} */
    MastComponent.prototype.log;
    /** @type {?} */
    MastComponent.prototype.ns;
    /** @type {?} */
    MastComponent.prototype.wss;
    /** @type {?} */
    MastComponent.prototype.router;
    /** @type {?} */
    MastComponent.prototype.zone;
    /** @type {?} */
    MastComponent.prototype.window;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9ndWkyLWZ3LWxpYi8iLCJzb3VyY2VzIjpbImxpYi9tYXN0L21hc3QvbWFzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7OztBQUtsRTtJQXlESSx1QkFDWSxJQUFpQixFQUNqQixHQUFlLEVBQ2hCLEVBQWMsRUFDYixHQUFxQixFQUNyQixNQUFjLEVBQ2QsSUFBWSxFQUNNLE1BQVc7UUFON0IsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUNqQixRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDYixRQUFHLEdBQUgsR0FBRyxDQUFrQjtRQUNyQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNNLFdBQU0sR0FBTixNQUFNLENBQUs7O1FBWHpDLFlBQU8sR0FBRyxJQUFJLEdBQUcsQ0FBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7O1FBQzVELG1CQUFjLEdBQVcsRUFBRSxDQUFDO1FBQzVCLGtCQUFhLEdBQVcsRUFBRSxDQUFDO1FBV3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxnRUFBZ0UsQ0FBQyxDQUFDO1FB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LHVDQUE0Qjs7SUFDNUIsc0NBQTJCOztJQUd2Qiw2QkFBeUI7O0lBQ3pCLDRCQUF1Qjs7SUFDdkIsMkJBQXFCOztJQUNyQiw0QkFBNkI7O0lBQzdCLCtCQUFzQjs7SUFDdEIsNkJBQW9COztJQUNwQiwrQkFBcUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTgtcHJlc2VudCBPcGVuIE5ldHdvcmtpbmcgRm91bmRhdGlvblxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBPbkRlc3Ryb3ksIEluamVjdCwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgTGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi91dGlsL2xpb24uc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmF2U2VydmljZSB9IGZyb20gJy4uLy4uL25hdi9uYXYuc2VydmljZSc7XG5pbXBvcnQgeyBXZWJTb2NrZXRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vcmVtb3RlL3dlYnNvY2tldC5zZXJ2aWNlJztcblxuLyoqXG4gKiBPTk9TIEdVSSAtLSBNYXN0aGVhZCBDb21wb25lbnRcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnb25vcy1tYXN0JyxcbiAgdGVtcGxhdGU6IGA8IS0tXG5+IENvcHlyaWdodCAyMDE4LXByZXNlbnQgT3BlbiBOZXR3b3JraW5nIEZvdW5kYXRpb25cbn5cbn4gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbn4geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxufiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbn5cbn4gICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuflxufiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5+IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbn4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5+IFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbn4gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4tLT5cbjxkaXYgaWQ9XCJtYXN0LXRvcC1ibG9ja1wiPjwvZGl2PlxuPCEtLSBUaGUgbWFzdC10b3AtYmxvY2sgaXMgYW4gaW5saW5lIGRpc3BsYXkgZWxlbWVudCB0aGF0IHB1c2hlcyBhbnlcbiAgc3Vic2VxdWVudCBlbGVtZW50cyBkb3duIHRoZSBwYWdlLiBJdCBoYXMgYSBoZWlnaHQgb2YgNDhweFxuICAgICBUaGUgbWFzdCBibG9jayBvdmVybGF5cyB0aGUgbWFzdC10b3AtYmxvY2suIEl0IGlzIGlzIHBvc2l0aW9uZWRcbiAgICAgYWJzb2x1dGVseSBzbyB0aGF0IHRoZSBuYXYgY29tcG9uZW50IGNhbiBzbGlkZSBpbiBiZWhpbmQgaXQgd2hlblxuICAgICBub3Qgc2hvd24gLS0+XG48ZGl2IGlkPVwibWFzdFwiIGFsaWduPVwibGVmdFwiPlxuICAgIDxzcGFuIGNsYXNzPVwibmF2LW1lbnUtYnV0dG9uIGNsaWNrYWJsZVwiIChjbGljayk9XCJucy50b2dnbGVOYXYoKVwiPlxuICAgICAgICA8aW1nIHNyYz1cImRhdGEvaW1nL25hdi1tZW51LW1vam8ucG5nXCIvPlxuICAgIDwvc3Bhbj5cbiAgICA8aW1nIGNsYXNzPVwibG9nb1wiIHNyYz1cImRhdGEvaW1nL21hc3RoZWFkLWxvZ28tbW9qby5wbmdcIj5cbiAgICA8b25vcy1jb25maXJtIHRpdGxlPVwie3sgbGlvbkZuKCd1aV9va190b191cGRhdGUnKSB9fVwiIG1lc3NhZ2U9XCJ7eyBjb25maXJtTWVzc2FnZSB9fVwiIHdhcm5pbmc9XCJ7eyBzdHJvbmdXYXJuaW5nIH19XCIgKGNob3Nlbik9XCJkT2soJGV2ZW50KVwiPjwvb25vcy1jb25maXJtPlxuICAgIDxkaXYgaWQ9XCJtYXN0LXJpZ2h0XCI+XG4gICAgICAgIDxuYXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd24tcGFyZW50XCI+XG4gICAgICAgICAgICAgICAgPGEgY2xhc3M9XCJjbGlja2FibGUgdXNlci1tZW51X19uYW1lXCI+e3sgdXNlcm5hbWUgfX0gPGkgY2xhc3M9XCJkcm9wZG93bi1pY29uXCI+PC9pPjwvYT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZHJvcGRvd25cIj5cbiAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cInJzL2xvZ291dFwiPiB7eyBsaW9uRm4oJ2xvZ291dCcpIH19IDwvYT5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN0cmwtYnRuc1wiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJhY3RpdmUgY2xpY2thYmxlIGljb25cIiAoY2xpY2spPVwiZGlyZWN0VG8oKVwiPlxuICAgICAgICAgICAgICAgICAgICA8b25vcy1pY29uIGljb25JZD1cInF1ZXJ5XCIgaWNvblNpemU9XCIzMlwiIHRvb2xUaXA9XCJ7eyBsaW9uRm4oJ3R0X2hlbHAnKSB9fVwiPjwvb25vcy1pY29uPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvbmF2PlxuXG4gICAgPC9kaXY+XG48L2Rpdj5cbmAsXG4gIHN0eWxlczogW2AjbWFzdC10b3AtYmxvY2t7ZGlzcGxheTpibG9jazt6LWluZGV4Oi0xO2hlaWdodDo0OHB4O3dpZHRoOjEwMCV9I21hc3R7cG9zaXRpb246YWJzb2x1dGU7d2lkdGg6MTAwJTt0b3A6MDtoZWlnaHQ6NDhweDtwYWRkaW5nOjA7ei1pbmRleDoxMDAwMH0jbWFzdCBhOmhvdmVye3RleHQtZGVjb3JhdGlvbjpub25lfWh0bWxbZGF0YS1wbGF0Zm9ybT1pUGFkXSAjbWFzdHtwYWRkaW5nLXRvcDoxNnB4fSNtYXN0IC5uYXYtbWVudS1idXR0b257ZGlzcGxheTppbmxpbmUtYmxvY2s7dmVydGljYWwtYWxpZ246bWlkZGxlO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjQ4cHg7cGFkZGluZzowIDEycHg7Y3Vyc29yOnBvaW50ZXI7Y3Vyc29yOmhhbmQ7Zm9udC1zaXplOjB9I21hc3QgLm5hdi1tZW51LWJ1dHRvbiBpbWd7d2lkdGg6MjVweDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGV9I21hc3QgLmxvZ297aGVpZ2h0OjQ3cHg7d2lkdGg6NTExcHg7dmVydGljYWwtYWxpZ246Ym90dG9tfSNtYXN0LXJpZ2h0e2Rpc3BsYXk6aW5saW5lLWJsb2NrO2Zsb2F0OnJpZ2h0O3Bvc2l0aW9uOnJlbGF0aXZlO3RvcDowO3BhZGRpbmctcmlnaHQ6MTVweDtsaW5lLWhlaWdodDo0OHB4fSNtYXN0LXJpZ2h0IGRpdi5jdHJsLWJ0bnN7ZmxvYXQ6cmlnaHR9I21hc3QtcmlnaHQgZGl2Lmljb257Ym94LXNpemluZzpib3JkZXItYm94O3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDo0OHB4O3dpZHRoOjQ4cHg7cGFkZGluZzo5cHh9I21hc3QgLmRyb3Bkb3duLXBhcmVudHtwb3NpdGlvbjpyZWxhdGl2ZTtmbG9hdDpyaWdodH0jbWFzdCAuZHJvcGRvd24tcGFyZW50IGkuZHJvcGRvd24taWNvbntkaXNwbGF5OmlubGluZS1ibG9jaztoZWlnaHQ6N3B4O3dpZHRoOjlweDttYXJnaW4tbGVmdDoxMHB4O2JhY2tncm91bmQ6dXJsKGRhdGEvaW1nL2Ryb3Bkb3duLWljb24ucG5nKSBuby1yZXBlYXR9I21hc3QgLmRyb3Bkb3due3Bvc2l0aW9uOmFic29sdXRlO3RvcDo0MHB4O3JpZ2h0Oi04cHg7ZGlzcGxheTpub25lO21pbi13aWR0aDoxMDBweDtsaW5lLWhlaWdodDoxNnB4O2ZvbnQtc2l6ZToxMnB0O3otaW5kZXg6MTAwMH0jbWFzdCAuZHJvcGRvd24gYXt0ZXh0LWRlY29yYXRpb246bm9uZTtmb250LXNpemU6MTJweDtkaXNwbGF5OmJsb2NrO3BhZGRpbmc6OHB4IDE2cHggNnB4IDEycHh9I21hc3QgLmRyb3Bkb3duLXBhcmVudDpob3ZlciAuZHJvcGRvd257ZGlzcGxheTpibG9ja30jbWFzdCAuZHJvcGRvd24tcGFyZW50OmhvdmVyIGkuZHJvcGRvd24taWNvbntiYWNrZ3JvdW5kLXBvc2l0aW9uLXg6LTE0cHh9aHRtbFtkYXRhLXBsYXRmb3JtPWlQYWRdICNtYXN0IC5kcm9wZG93bnt0b3A6NTdweH1gLCBgI21hc3R7YmFja2dyb3VuZC1jb2xvcjojMjMxZjIwfSNtYXN0IC5uYXYtbWVudS1idXR0b246aG92ZXJ7YmFja2dyb3VuZC1jb2xvcjojODg4fSNtYXN0IG5hdiwjbWFzdC1yaWdodCBhe2NvbG9yOiMwMDlmZGJ9I21hc3QgLmRyb3Bkb3due2JhY2tncm91bmQtY29sb3I6IzIzMWYyMDtib3JkZXI6MXB4IHNvbGlkICNkZGR9I21hc3QgLmRyb3Bkb3duIGF7Y29sb3I6IzAwOWZkYjtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjNDQ0fSNtYXN0IC5kcm9wZG93biBhOmhvdmVye2NvbG9yOiNmZmZ9YF1cbn0pXG5leHBvcnQgY2xhc3MgTWFzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgICBASW5wdXQoKSB1c2VybmFtZTogc3RyaW5nO1xuXG4gICAgbGlvbkZuOyAvLyBGdW5jdGlvblxuICAgIHZpZXdNYXAgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPihbXSk7IC8vIEEgbWFwIG9mIGFwcCBuYW1lc1xuICAgIGNvbmZpcm1NZXNzYWdlOiBzdHJpbmcgPSAnJztcbiAgICBzdHJvbmdXYXJuaW5nOiBzdHJpbmcgPSAnJztcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGxpb246IExpb25TZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIGxvZzogTG9nU2VydmljZSxcbiAgICAgICAgcHVibGljIG5zOiBOYXZTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHdzczogV2ViU29ja2V0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSB6b25lOiBOZ1pvbmUsXG4gICAgICAgIEBJbmplY3QoJ1dpbmRvdycpIHByaXZhdGUgd2luZG93OiBhbnksXG4gICAgKSB7XG4gICAgICAgIHRoaXMudmlld01hcC5zZXQoJ2FwcHMnLCAnaHR0cHM6Ly93aWtpLm9ub3Nwcm9qZWN0Lm9yZy9kaXNwbGF5L09OT1MvR1VJK0FwcGxpY2F0aW9uK1ZpZXcnKTtcbiAgICAgICAgdGhpcy52aWV3TWFwLnNldCgnZGV2aWNlJywgJ2h0dHBzOi8vd2lraS5vbm9zcHJvamVjdC5vcmcvZGlzcGxheS9PTk9TL0dVSStEZXZpY2UrVmlldycpO1xuICAgICAgICB0aGlzLnZpZXdNYXAuc2V0KCcnLCAnaHR0cHM6Ly93aWtpLm9ub3Nwcm9qZWN0Lm9yZy9kaXNwbGF5L09OT1MvVGhlK09OT1MrV2ViK0dVSScpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBpZiAodGhpcy5saW9uLnViZXJjYWNoZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMubGlvbkZuID0gdGhpcy5kdW1teUxpb247XG4gICAgICAgICAgICB0aGlzLmxpb24ubG9hZENicy5zZXQoJ21hc3QnLCAoKSA9PiB0aGlzLmRvTGlvbigpKTtcbiAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKCdMSU9OIG5vdCBhdmFpbGFibGUgd2hlbiBNYXN0Q29tcG9uZW50IGluaXRpYWxpemVkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRvTGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy53c3MuYmluZEhhbmRsZXJzKG5ldyBNYXA8c3RyaW5nLCAoZGF0YSkgPT4gdm9pZD4oW1xuICAgICAgICAgICAgWydndWlSZW1vdmVkJywgKGRhdGEpID0+IHRoaXMudHJpZ2dlclJlZnJlc2goZGF0YSwgZmFsc2UpIF0sXG4gICAgICAgICAgICBbJ2d1aUFkZGVkJywgKGRhdGEpID0+IHRoaXMudHJpZ2dlclJlZnJlc2goZGF0YSwgdHJ1ZSkgXVxuICAgICAgICBdKSk7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKCdNYXN0Q29tcG9uZW50IGluaXRpYWxpemVkJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTmF2IGNvbXBvbmVudCBzaG91bGQgbmV2ZXIgYmUgY2xvc2VkLCBidXQgaW4gY2FzZSBpdCBkb2VzLCBpdCdzXG4gICAgICogc2FmZXIgdG8gdGlkeSB1cCBhZnRlciBpdHNlbGZcbiAgICAgKi9cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5saW9uLmxvYWRDYnMuZGVsZXRlKCdtYXN0Jyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBSZWFkIHRoZSBMSU9OIGJ1bmRsZSBmb3IgQXBwIGFuZCBzZXQgdXAgdGhlIGxpb25GblxuICAgICovXG4gICAgZG9MaW9uKCkge1xuICAgICAgICB0aGlzLmxpb25GbiA9IHRoaXMubGlvbi5idW5kbGUoJ2NvcmUuZncuTWFzdCcpO1xuICAgICAgICBpZiAodGhpcy51c2VybmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXJuYW1lID0gdGhpcy5saW9uRm4oJ3Vua25vd25fdXNlcicpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgKiBBIGR1bW15IGltcGxlbWVudGF0aW9uIG9mIHRoZSBsaW9uRm4gdW50aWwgdGhlIHJlc3BvbnNlIGlzIHJlY2VpdmVkIGFuZCB0aGUgTElPTlxuICAgICogYnVuZGxlIGlzIHJlY2VpdmVkIGZyb20gdGhlIFdlYlNvY2tldFxuICAgICovXG4gICAgZHVtbXlMaW9uKGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICclJyArIGtleSArICclJztcbiAgICB9XG5cbiAgICBkaXJlY3RUbygpIHtcbiAgICAgICAgY29uc3QgY3VySWQgPSB0aGlzLndpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKCcvJywgJycpO1xuICAgICAgICBsZXQgaGVscFVybDogc3RyaW5nID0gdGhpcy52aWV3TWFwLmdldChjdXJJZCk7XG4gICAgICAgIGlmIChoZWxwVXJsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhlbHBVcmwgPSB0aGlzLnZpZXdNYXAuZ2V0KCcnKTtcbiAgICAgICAgICAgIHRoaXMubG9nLndhcm4oJ05vIGhlbHAgZmlsZSBsaW5rZWQgZm9yIHZpZXc6JywgY3VySWQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud2luZG93Lm9wZW4oaGVscFVybCk7XG4gICAgfVxuXG4gICAgdHJpZ2dlclJlZnJlc2goZGF0YTogYW55LCBhZGRlZDogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLmNvbmZpcm1NZXNzYWdlID0gdGhpcy5saW9uRm4oYWRkZWQgPyAndWljb21wX2FkZGVkJyA6ICd1aWNvbXBfcmVtb3ZlZCcpO1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnUmVmcmVzaCBoYXMgYmVlbiB0cmlnZ2VyZWQgLSBpdGVtJywgYWRkZWQgPyAnYWRkZWQnIDogJ3JlbW92ZWQnLCAnIC0gJywgZGF0YSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgd2hlbiB0aGUgQ29uZmlybSBkaWFsb2cgaXMgc2hvd24gYW5kIGEgY2hvaWNlIGlzIG1hZGVcbiAgICAgKi9cbiAgICBkT2soY2hvaWNlOiBib29sZWFuKSB7XG4gICAgICAgIGlmIChjaG9pY2UpIHtcbiAgICAgICAgICAgIHRoaXMubnMuZ2V0VWlWaWV3cygpO1xuICAgICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvJ10pO1xuICAgICAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ1JlZnJlc2ggY29uZmlybWVkJyk7IC8vIFdpbGwgbm90IGJlIHByaW50ZWQgaWYgcGFnZSByZWxvYWRzXG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nLmRlYnVnKCdSZWZyZXNoIGNhbmNlbGxlZCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29uZmlybU1lc3NhZ2UgPSAnJztcbiAgICAgICAgdGhpcy5zdHJvbmdXYXJuaW5nID0gJyc7XG4gICAgfVxufVxuIl19