/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/** @type {?} */
const REFRESH_INTERVAL = 2000;
/** @type {?} */
const SEARCH_REGEX = '\\W';
/**
 * Model of table annotations within this table base class
 * @record
 */
export function TableAnnots() { }
if (false) {
    /** @type {?} */
    TableAnnots.prototype.noRowsMsg;
}
/**
 * A model of data returned from Web Socket in a TableResponse
 *
 * There is an interface extending from this one in the parent component
 * @record
 */
export function TableResponse() { }
if (false) {
    /** @type {?} */
    TableResponse.prototype.annots;
}
/**
 * A criteria for filtering the tableData
 * @record
 */
export function TableFilter() { }
if (false) {
    /** @type {?} */
    TableFilter.prototype.queryStr;
    /** @type {?} */
    TableFilter.prototype.queryBy;
    /** @type {?} */
    TableFilter.prototype.sortBy;
}
/** @enum {string} */
const SortDir = {
    asc: 'asc', desc: 'desc',
};
export { SortDir };
/**
 * A structure to format sort params for table
 * This is sent to WebSocket as part of table request
 * @record
 */
export function SortParams() { }
if (false) {
    /** @type {?} */
    SortParams.prototype.firstCol;
    /** @type {?} */
    SortParams.prototype.firstDir;
    /** @type {?} */
    SortParams.prototype.secondCol;
    /** @type {?} */
    SortParams.prototype.secondDir;
}
/**
 * @record
 */
export function PayloadParams() { }
if (false) {
    /** @type {?} */
    PayloadParams.prototype.devId;
}
/**
 * ONOS GUI -- Widget -- Table Base class
 * @abstract
 */
export class TableBaseImpl {
    /**
     * @param {?} fs
     * @param {?} ls
     * @param {?} log
     * @param {?} wss
     * @param {?} tag
     * @param {?=} idKey
     * @param {?=} selCb
     */
    constructor(fs, ls, log, wss, tag, idKey = 'id', selCb = () => ({}) // Function
    ) {
        this.fs = fs;
        this.ls = ls;
        this.log = log;
        this.wss = wss;
        this.tag = tag;
        this.idKey = idKey;
        this.selCb = selCb;
        this.changedData = [];
        // Function
        this.parentSelCb = null;
        // Function
        this.selId = undefined;
        this.tableData = [];
        // Function
        this.autoRefresh = true;
        this.autoRefreshTip = 'Toggle auto refresh'; // TODO: get LION string
        this.refreshPromise = null;
        this.handlers = [];
        this.root = tag + 's';
        this.req = tag + 'DataRequest';
        this.resp = tag + 'DataResponse';
        this.selectCallback = this.rowSelectionCb;
        this.toggleRefresh = () => {
            this.autoRefresh = !this.autoRefresh;
            this.autoRefresh ? this.startRefresh() : this.stopRefresh();
        };
        // Mapped to the search and searchBy inputs in template
        // Changes are handled through TableFilterPipe
        this.tableDataFilter = (/** @type {?} */ ({
            queryStr: '',
            queryBy: '$',
        }));
    }
    /**
     * @return {?}
     */
    init() {
        this.wss.bindHandlers(new Map([
            [this.resp, (data) => this.tableDataResponseCb(data)]
        ]));
        this.handlers.push(this.resp);
        this.annots = (/** @type {?} */ ({
            noRowsMsg: ''
        }));
        // Now send the WebSocket request and make it repeat every 2 seconds
        this.requestTableData();
        this.startRefresh();
        this.log.debug('TableBase initialized. Calling ', this.req, 'every', REFRESH_INTERVAL, 'ms');
    }
    /**
     * @return {?}
     */
    destroy() {
        this.wss.unbindHandlers(this.handlers);
        this.stopRefresh();
        this.ls.stop();
    }
    /**
     * A callback that executes when the table data that was requested
     * on WebSocketService arrives.
     *
     * Happens every 2 seconds
     * @param {?} data
     * @return {?}
     */
    tableDataResponseCb(data) {
        this.ls.stop();
        /** @type {?} */
        const newTableData = Array.from(data[this.root]);
        this.annots.noRowsMsg = data.annots.no_rows_msg;
        // If the parents onResp() function is set then call it
        if (this.responseCallback) {
            this.responseCallback(data);
        }
        this.changedData = [];
        // checks if data changed for row flashing
        if (JSON.stringify(newTableData) !== JSON.stringify(this.tableData)) {
            this.log.debug('table data has changed');
            /** @type {?} */
            const oldTableData = this.tableData;
            this.tableData = [...newTableData]; // ES6 spread syntax
            // only flash the row if the data already exists
            if (oldTableData.length > 0) {
                for (const idx in newTableData) {
                    if (!this.fs.containsObj(oldTableData, newTableData[idx])) {
                        this.changedData.push(newTableData[idx][this.idKey]);
                    }
                }
            }
        }
    }
    /**
     * Table Data Request
     * Pass in sort parameters and the set will be returned sorted
     * In the old GUI there was also a query parameter, but this was not
     * implemented on the server end
     * @return {?}
     */
    requestTableData() {
        /** @type {?} */
        const p = Object.assign({}, this.sortParams, this.payloadParams);
        // Allow it to sit in pending events
        if (this.wss.isConnected()) {
            if (this.fs.debugOn('table')) {
                this.log.debug('Table data REQUEST:', this.req, p);
            }
            this.wss.sendEvent(this.req, p);
            this.ls.start();
        }
    }
    /**
     * Row Selected
     * @param {?} event
     * @param {?} selRow
     * @return {?}
     */
    rowSelectionCb(event, selRow) {
        /** @type {?} */
        const selId = selRow[this.idKey];
        this.selId = (this.selId === selId) ? undefined : selId;
        this.log.debug('Row', selId, 'selected');
        if (this.parentSelCb) {
            this.parentSelCb(event, selRow);
        }
    }
    /**
     * autoRefresh functions
     * @return {?}
     */
    startRefresh() {
        this.refreshPromise =
            setInterval(() => {
                if (!this.ls.waiting()) {
                    if (this.fs.debugOn('table')) {
                        this.log.debug('Refreshing ' + this.root + ' page');
                    }
                    this.requestTableData();
                }
            }, REFRESH_INTERVAL);
    }
    /**
     * @return {?}
     */
    stopRefresh() {
        if (this.refreshPromise) {
            clearInterval(this.refreshPromise);
            this.refreshPromise = null;
        }
    }
    /**
     * @param {?} id
     * @return {?}
     */
    isChanged(id) {
        return (this.fs.inArray(id, this.changedData) === -1) ? false : true;
    }
    /**
     * A dummy implementation of the lionFn until the response is received and the LION
     * bundle is received from the WebSocket
     * @param {?} key
     * @return {?}
     */
    dummyLion(key) {
        return '%' + key + '%';
    }
    /**
     * Change the sort order of the data returned
     *
     * sortParams are passed to the server by WebSocket and the data is
     * returned sorted
     *
     * This is usually assigned to the (click) event on a column, and the column
     * name passed in e.g. (click)="onSort('origin')
     * If the column that is passed in is already the firstCol, then reverse its direction
     * If a new column is passed in, then make the existing col the 2nd sort order
     * @param {?} colName
     * @return {?}
     */
    onSort(colName) {
        if (this.sortParams.firstCol === colName) {
            if (this.sortParams.firstDir === SortDir.desc) {
                this.sortParams.firstDir = SortDir.asc;
                return;
            }
            else {
                this.sortParams.firstDir = SortDir.desc;
                return;
            }
        }
        else {
            this.sortParams.secondCol = this.sortParams.firstCol;
            this.sortParams.secondDir = this.sortParams.firstDir;
            this.sortParams.firstCol = colName;
            this.sortParams.firstDir = SortDir.desc;
        }
        this.log.debug('Sort params', this.sortParams);
        this.requestTableData();
    }
    /**
     * @param {?} column
     * @return {?}
     */
    sortIcon(column) {
        if (this.sortParams.firstCol === column) {
            if (this.sortParams.firstDir === SortDir.asc) {
                return 'upArrow';
            }
            else {
                return 'downArrow';
            }
        }
        else {
            return '';
        }
    }
    /**
     * De-selects the row
     * @param {?} event
     * @return {?}
     */
    deselectRow(event) {
        this.log.debug('Details panel close event');
        this.selId = event;
    }
}
if (false) {
    /** @type {?} */
    TableBaseImpl.prototype.annots;
    /** @type {?} */
    TableBaseImpl.prototype.changedData;
    /** @type {?} */
    TableBaseImpl.prototype.payloadParams;
    /** @type {?} */
    TableBaseImpl.prototype.sortParams;
    /** @type {?} */
    TableBaseImpl.prototype.selectCallback;
    /** @type {?} */
    TableBaseImpl.prototype.parentSelCb;
    /** @type {?} */
    TableBaseImpl.prototype.responseCallback;
    /** @type {?} */
    TableBaseImpl.prototype.selId;
    /** @type {?} */
    TableBaseImpl.prototype.tableData;
    /** @type {?} */
    TableBaseImpl.prototype.tableDataFilter;
    /** @type {?} */
    TableBaseImpl.prototype.toggleRefresh;
    /** @type {?} */
    TableBaseImpl.prototype.autoRefresh;
    /** @type {?} */
    TableBaseImpl.prototype.autoRefreshTip;
    /** @type {?} */
    TableBaseImpl.prototype.root;
    /** @type {?} */
    TableBaseImpl.prototype.req;
    /** @type {?} */
    TableBaseImpl.prototype.resp;
    /** @type {?} */
    TableBaseImpl.prototype.refreshPromise;
    /** @type {?} */
    TableBaseImpl.prototype.handlers;
    /** @type {?} */
    TableBaseImpl.prototype.fs;
    /** @type {?} */
    TableBaseImpl.prototype.ls;
    /** @type {?} */
    TableBaseImpl.prototype.log;
    /** @type {?} */
    TableBaseImpl.prototype.wss;
    /** @type {?} */
    TableBaseImpl.prototype.tag;
    /** @type {?} */
    TableBaseImpl.prototype.idKey;
    /** @type {?} */
    TableBaseImpl.prototype.selCb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUuYmFzZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2d1aTItZnctbGliLyIsInNvdXJjZXMiOlsibGliL3dpZGdldC90YWJsZS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O01BcUJNLGdCQUFnQixHQUFHLElBQUk7O01BQ3ZCLFlBQVksR0FBRyxLQUFLOzs7OztBQUsxQixpQ0FFQzs7O0lBREcsZ0NBQWtCOzs7Ozs7OztBQVF0QixtQ0FJQzs7O0lBSEcsK0JBQVk7Ozs7OztBQVFoQixpQ0FJQzs7O0lBSEcsK0JBQWlCOztJQUNqQiw4QkFBZ0I7O0lBQ2hCLDZCQUFlOzs7O0lBT2YsS0FBTSxLQUFLLEVBQUUsTUFBTyxNQUFNOzs7Ozs7OztBQU85QixnQ0FLQzs7O0lBSkcsOEJBQWlCOztJQUNqQiw4QkFBa0I7O0lBQ2xCLCtCQUFrQjs7SUFDbEIsK0JBQW1COzs7OztBQUd2QixtQ0FFQzs7O0lBREcsOEJBQWM7Ozs7OztBQU9sQixNQUFNLE9BQWdCLGFBQWE7Ozs7Ozs7Ozs7SUFzQi9CLFlBQ2MsRUFBYSxFQUNiLEVBQWtCLEVBQ2xCLEdBQWUsRUFDZixHQUFxQixFQUNyQixHQUFXLEVBQ1gsUUFBZ0IsSUFBSSxFQUNwQixRQUFRLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVzs7UUFOOUIsT0FBRSxHQUFGLEVBQUUsQ0FBVztRQUNiLE9BQUUsR0FBRixFQUFFLENBQWdCO1FBQ2xCLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFDZixRQUFHLEdBQUgsR0FBRyxDQUFrQjtRQUNyQixRQUFHLEdBQUgsR0FBRyxDQUFRO1FBQ1gsVUFBSyxHQUFMLEtBQUssQ0FBZTtRQUNwQixVQUFLLEdBQUwsS0FBSyxDQUFhO1FBMUJ0QixnQkFBVyxHQUFhLEVBQUUsQ0FBQzs7UUFJM0IsZ0JBQVcsR0FBRyxJQUFJLENBQUM7O1FBRTdCLFVBQUssR0FBVyxTQUFTLENBQUM7UUFDMUIsY0FBUyxHQUFVLEVBQUUsQ0FBQzs7UUFHdEIs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T0FBTyxTQUFTLENBQUM7YUFDcEI7aUJBQU07Z0JBQ0gsT0FBTyxXQUFXLENBQUM7YUFDdEI7U0FDSjthQUFNO1lBQ0gsT0FBTyxFQUFFLENBQUM7U0FDYjtJQUNMLENBQUM7Ozs7OztJQUtELFdBQVcsQ0FBQyxLQUFLO1FBQ2IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUN2QixDQUFDO0NBQ0o7OztJQTFORywrQkFBMkI7O0lBQzNCLG9DQUFxQzs7SUFDckMsc0NBQXVDOztJQUN2QyxtQ0FBaUM7O0lBQ2pDLHVDQUFzQjs7SUFDdEIsb0NBQTZCOztJQUM3Qix5Q0FBMkI7O0lBQzNCLDhCQUEwQjs7SUFDMUIsa0NBQXNCOztJQUN0Qix3Q0FBNkI7O0lBQzdCLHNDQUFjOztJQUNkLG9DQUE0Qjs7SUFDNUIsdUNBQStDOztJQUUvQyw2QkFBc0I7O0lBQ3RCLDRCQUFxQjs7SUFDckIsNkJBQXNCOztJQUN0Qix1Q0FBbUM7O0lBQ25DLGlDQUFnQzs7SUFHNUIsMkJBQXVCOztJQUN2QiwyQkFBNEI7O0lBQzVCLDRCQUF5Qjs7SUFDekIsNEJBQStCOztJQUMvQiw0QkFBcUI7O0lBQ3JCLDhCQUE4Qjs7SUFDOUIsOEJBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LXByZXNlbnQgT3BlbiBOZXR3b3JraW5nIEZvdW5kYXRpb25cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IEZuU2VydmljZSB9IGZyb20gJy4uL3V0aWwvZm4uc2VydmljZSc7XG5pbXBvcnQgeyBMb2FkaW5nU2VydmljZSB9IGZyb20gJy4uL2xheWVyL2xvYWRpbmcuc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJy4uL3JlbW90ZS93ZWJzb2NrZXQuc2VydmljZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiB9IGZyb20gJ3J4anMnO1xuXG5jb25zdCBSRUZSRVNIX0lOVEVSVkFMID0gMjAwMDtcbmNvbnN0IFNFQVJDSF9SRUdFWCA9ICdcXFxcVyc7XG5cbi8qKlxuICogTW9kZWwgb2YgdGFibGUgYW5ub3RhdGlvbnMgd2l0aGluIHRoaXMgdGFibGUgYmFzZSBjbGFzc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhYmxlQW5ub3RzIHtcbiAgICBub1Jvd3NNc2c6IHN0cmluZztcbn1cblxuLyoqXG4gKiBBIG1vZGVsIG9mIGRhdGEgcmV0dXJuZWQgZnJvbSBXZWIgU29ja2V0IGluIGEgVGFibGVSZXNwb25zZVxuICpcbiAqIFRoZXJlIGlzIGFuIGludGVyZmFjZSBleHRlbmRpbmcgZnJvbSB0aGlzIG9uZSBpbiB0aGUgcGFyZW50IGNvbXBvbmVudFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhYmxlUmVzcG9uc2Uge1xuICAgIGFubm90czogYW55O1xuICAgIC8vIFRoZXJlIHdpbGwgYmUgb3RoZXIgcGFydHMgdG8gdGhlIHJlc3BvbnNlIGRlcGVuZGluZyBvbiB0YWJsZSB0eXBlXG4gICAgLy8gRXhwZWN0IG9uZSBjYWxsZWQgdGFnKydzJyBlLmcuIGRldmljZXMgb3IgYXBwc1xufVxuXG4vKipcbiAqIEEgY3JpdGVyaWEgZm9yIGZpbHRlcmluZyB0aGUgdGFibGVEYXRhXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGFibGVGaWx0ZXIge1xuICAgIHF1ZXJ5U3RyOiBzdHJpbmc7XG4gICAgcXVlcnlCeTogc3RyaW5nO1xuICAgIHNvcnRCeTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEVudW1lcmF0ZWQgdmFsdWVzIGZvciB0aGUgc29ydCBkaXJcbiAqL1xuZXhwb3J0IGVudW0gU29ydERpciB7XG4gICAgYXNjID0gJ2FzYycsIGRlc2MgPSAnZGVzYydcbn1cblxuLyoqXG4gKiBBIHN0cnVjdHVyZSB0byBmb3JtYXQgc29ydCBwYXJhbXMgZm9yIHRhYmxlXG4gKiBUaGlzIGlzIHNlbnQgdG8gV2ViU29ja2V0IGFzIHBhcnQgb2YgdGFibGUgcmVxdWVzdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNvcnRQYXJhbXMge1xuICAgIGZpcnN0Q29sOiBzdHJpbmc7XG4gICAgZmlyc3REaXI6IFNvcnREaXI7XG4gICAgc2Vjb25kQ29sOiBzdHJpbmc7XG4gICAgc2Vjb25kRGlyOiBTb3J0RGlyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBheWxvYWRQYXJhbXMge1xuICAgIGRldklkOiBzdHJpbmc7XG59XG5cblxuLyoqXG4gKiBPTk9TIEdVSSAtLSBXaWRnZXQgLS0gVGFibGUgQmFzZSBjbGFzc1xuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGFibGVCYXNlSW1wbCB7XG4gICAgLy8gYXR0cmlidXRlcyBmcm9tIHRoZSBpbnRlcmZhY2VcbiAgICBwdWJsaWMgYW5ub3RzOiBUYWJsZUFubm90cztcbiAgICBwcm90ZWN0ZWQgY2hhbmdlZERhdGE6IHN0cmluZ1tdID0gW107XG4gICAgcHJvdGVjdGVkIHBheWxvYWRQYXJhbXM6IFBheWxvYWRQYXJhbXM7XG4gICAgcHJvdGVjdGVkIHNvcnRQYXJhbXM6IFNvcnRQYXJhbXM7XG4gICAgcHVibGljIHNlbGVjdENhbGxiYWNrOyAvLyBGdW5jdGlvblxuICAgIHByb3RlY3RlZCBwYXJlbnRTZWxDYiA9IG51bGw7XG4gICAgcHJvdGVjdGVkIHJlc3BvbnNlQ2FsbGJhY2s7IC8vIEZ1bmN0aW9uXG4gICAgc2VsSWQ6IHN0cmluZyA9IHVuZGVmaW5lZDtcbiAgICB0YWJsZURhdGE6IGFueVtdID0gW107XG4gICAgdGFibGVEYXRhRmlsdGVyOiBUYWJsZUZpbHRlcjtcbiAgICB0b2dnbGVSZWZyZXNoOyAvLyBGdW5jdGlvblxuICAgIGF1dG9SZWZyZXNoOiBib29sZWFuID0gdHJ1ZTtcbiAgICBhdXRvUmVmcmVzaFRpcDogc3RyaW5nID0gJ1RvZ2dsZSBhdXRvIHJlZnJlc2gnOyAvLyBUT0RPOiBnZXQgTElPTiBzdHJpbmdcblxuICAgIHJlYWRvbmx5IHJvb3Q6IHN0cmluZztcbiAgICByZWFkb25seSByZXE6IHN0cmluZztcbiAgICByZWFkb25seSByZXNwOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSByZWZyZXNoUHJvbWlzZTogYW55ID0gbnVsbDtcbiAgICBwcml2YXRlIGhhbmRsZXJzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgcHJvdGVjdGVkIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcm90ZWN0ZWQgZnM6IEZuU2VydmljZSxcbiAgICAgICAgcHJvdGVjdGVkIGxzOiBMb2FkaW5nU2VydmljZSxcbiAgICAgICAgcHJvdGVjdGVkIGxvZzogTG9nU2VydmljZSxcbiAgICAgICAgcHJvdGVjdGVkIHdzczogV2ViU29ja2V0U2VydmljZSxcbiAgICAgICAgcHJvdGVjdGVkIHRhZzogc3RyaW5nLFxuICAgICAgICBwcm90ZWN0ZWQgaWRLZXk6IHN0cmluZyA9ICdpZCcsXG4gICAgICAgIHByb3RlY3RlZCBzZWxDYiA9ICgpID0+ICh7fSkgLy8gRnVuY3Rpb25cbiAgICApIHtcbiAgICAgICAgdGhpcy5yb290ID0gdGFnICsgJ3MnO1xuICAgICAgICB0aGlzLnJlcSA9IHRhZyArICdEYXRhUmVxdWVzdCc7XG4gICAgICAgIHRoaXMucmVzcCA9IHRhZyArICdEYXRhUmVzcG9uc2UnO1xuXG4gICAgICAgIHRoaXMuc2VsZWN0Q2FsbGJhY2sgPSB0aGlzLnJvd1NlbGVjdGlvbkNiO1xuICAgICAgICB0aGlzLnRvZ2dsZVJlZnJlc2ggPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmF1dG9SZWZyZXNoID0gIXRoaXMuYXV0b1JlZnJlc2g7XG4gICAgICAgICAgICB0aGlzLmF1dG9SZWZyZXNoID8gdGhpcy5zdGFydFJlZnJlc2goKSA6IHRoaXMuc3RvcFJlZnJlc2goKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBNYXBwZWQgdG8gdGhlIHNlYXJjaCBhbmQgc2VhcmNoQnkgaW5wdXRzIGluIHRlbXBsYXRlXG4gICAgICAgIC8vIENoYW5nZXMgYXJlIGhhbmRsZWQgdGhyb3VnaCBUYWJsZUZpbHRlclBpcGVcbiAgICAgICAgdGhpcy50YWJsZURhdGFGaWx0ZXIgPSA8VGFibGVGaWx0ZXI+e1xuICAgICAgICAgICAgcXVlcnlTdHI6ICcnLFxuICAgICAgICAgICAgcXVlcnlCeTogJyQnLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMud3NzLmJpbmRIYW5kbGVycyhuZXcgTWFwPHN0cmluZywgKGRhdGEpID0+IHZvaWQ+KFtcbiAgICAgICAgICAgIFt0aGlzLnJlc3AsIChkYXRhKSA9PiB0aGlzLnRhYmxlRGF0YVJlc3BvbnNlQ2IoZGF0YSldXG4gICAgICAgIF0pKTtcbiAgICAgICAgdGhpcy5oYW5kbGVycy5wdXNoKHRoaXMucmVzcCk7XG5cbiAgICAgICAgdGhpcy5hbm5vdHMgPSA8VGFibGVBbm5vdHM+e1xuICAgICAgICAgICAgbm9Sb3dzTXNnOiAnJ1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIE5vdyBzZW5kIHRoZSBXZWJTb2NrZXQgcmVxdWVzdCBhbmQgbWFrZSBpdCByZXBlYXQgZXZlcnkgMiBzZWNvbmRzXG4gICAgICAgIHRoaXMucmVxdWVzdFRhYmxlRGF0YSgpO1xuICAgICAgICB0aGlzLnN0YXJ0UmVmcmVzaCgpO1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnVGFibGVCYXNlIGluaXRpYWxpemVkLiBDYWxsaW5nICcsIHRoaXMucmVxLFxuICAgICAgICAgICAgJ2V2ZXJ5JywgUkVGUkVTSF9JTlRFUlZBTCwgJ21zJyk7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy53c3MudW5iaW5kSGFuZGxlcnModGhpcy5oYW5kbGVycyk7XG4gICAgICAgIHRoaXMuc3RvcFJlZnJlc2goKTtcbiAgICAgICAgdGhpcy5scy5zdG9wKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBjYWxsYmFjayB0aGF0IGV4ZWN1dGVzIHdoZW4gdGhlIHRhYmxlIGRhdGEgdGhhdCB3YXMgcmVxdWVzdGVkXG4gICAgICogb24gV2ViU29ja2V0U2VydmljZSBhcnJpdmVzLlxuICAgICAqXG4gICAgICogSGFwcGVucyBldmVyeSAyIHNlY29uZHNcbiAgICAgKi9cbiAgICB0YWJsZURhdGFSZXNwb25zZUNiKGRhdGE6IFRhYmxlUmVzcG9uc2UpIHtcbiAgICAgICAgdGhpcy5scy5zdG9wKCk7XG5cbiAgICAgICAgY29uc3QgbmV3VGFibGVEYXRhOiBhbnlbXSA9IEFycmF5LmZyb20oZGF0YVt0aGlzLnJvb3RdKTtcbiAgICAgICAgdGhpcy5hbm5vdHMubm9Sb3dzTXNnID0gZGF0YS5hbm5vdHMubm9fcm93c19tc2c7XG5cbiAgICAgICAgLy8gSWYgdGhlIHBhcmVudHMgb25SZXNwKCkgZnVuY3Rpb24gaXMgc2V0IHRoZW4gY2FsbCBpdFxuICAgICAgICBpZiAodGhpcy5yZXNwb25zZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlQ2FsbGJhY2soZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jaGFuZ2VkRGF0YSA9IFtdO1xuXG4gICAgICAgIC8vIGNoZWNrcyBpZiBkYXRhIGNoYW5nZWQgZm9yIHJvdyBmbGFzaGluZ1xuICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkobmV3VGFibGVEYXRhKSAhPT0gSlNPTi5zdHJpbmdpZnkodGhpcy50YWJsZURhdGEpKSB7XG4gICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZygndGFibGUgZGF0YSBoYXMgY2hhbmdlZCcpO1xuICAgICAgICAgICAgY29uc3Qgb2xkVGFibGVEYXRhOiBhbnlbXSA9IHRoaXMudGFibGVEYXRhO1xuICAgICAgICAgICAgdGhpcy50YWJsZURhdGEgPSBbLi4ubmV3VGFibGVEYXRhXTsgLy8gRVM2IHNwcmVhZCBzeW50YXhcbiAgICAgICAgICAgIC8vIG9ubHkgZmxhc2ggdGhlIHJvdyBpZiB0aGUgZGF0YSBhbHJlYWR5IGV4aXN0c1xuICAgICAgICAgICAgaWYgKG9sZFRhYmxlRGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpZHggaW4gbmV3VGFibGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5mcy5jb250YWluc09iaihvbGRUYWJsZURhdGEsIG5ld1RhYmxlRGF0YVtpZHhdKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VkRGF0YS5wdXNoKG5ld1RhYmxlRGF0YVtpZHhdW3RoaXMuaWRLZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRhYmxlIERhdGEgUmVxdWVzdFxuICAgICAqIFBhc3MgaW4gc29ydCBwYXJhbWV0ZXJzIGFuZCB0aGUgc2V0IHdpbGwgYmUgcmV0dXJuZWQgc29ydGVkXG4gICAgICogSW4gdGhlIG9sZCBHVUkgdGhlcmUgd2FzIGFsc28gYSBxdWVyeSBwYXJhbWV0ZXIsIGJ1dCB0aGlzIHdhcyBub3RcbiAgICAgKiBpbXBsZW1lbnRlZCBvbiB0aGUgc2VydmVyIGVuZFxuICAgICAqL1xuICAgIHJlcXVlc3RUYWJsZURhdGEoKSB7XG4gICAgICAgIGNvbnN0IHAgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnNvcnRQYXJhbXMsIHRoaXMucGF5bG9hZFBhcmFtcyk7XG5cbiAgICAgICAgLy8gQWxsb3cgaXQgdG8gc2l0IGluIHBlbmRpbmcgZXZlbnRzXG4gICAgICAgIGlmICh0aGlzLndzcy5pc0Nvbm5lY3RlZCgpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5mcy5kZWJ1Z09uKCd0YWJsZScpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ1RhYmxlIGRhdGEgUkVRVUVTVDonLCB0aGlzLnJlcSwgcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLndzcy5zZW5kRXZlbnQodGhpcy5yZXEsIHApO1xuICAgICAgICAgICAgdGhpcy5scy5zdGFydCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUm93IFNlbGVjdGVkXG4gICAgICovXG4gICAgcm93U2VsZWN0aW9uQ2IoZXZlbnQ6IGFueSwgc2VsUm93OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgc2VsSWQ6IHN0cmluZyA9IHNlbFJvd1t0aGlzLmlkS2V5XTtcbiAgICAgICAgdGhpcy5zZWxJZCA9ICh0aGlzLnNlbElkID09PSBzZWxJZCkgPyB1bmRlZmluZWQgOiBzZWxJZDtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoJ1JvdycsIHNlbElkLCAnc2VsZWN0ZWQnKTtcbiAgICAgICAgaWYgKHRoaXMucGFyZW50U2VsQ2IpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50U2VsQ2IoZXZlbnQsIHNlbFJvdyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBhdXRvUmVmcmVzaCBmdW5jdGlvbnNcbiAgICAgKi9cbiAgICBzdGFydFJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaFByb21pc2UgPVxuICAgICAgICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5scy53YWl0aW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZnMuZGVidWdPbigndGFibGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ1JlZnJlc2hpbmcgJyArIHRoaXMucm9vdCArICcgcGFnZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdFRhYmxlRGF0YSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIFJFRlJFU0hfSU5URVJWQUwpO1xuICAgIH1cblxuICAgIHN0b3BSZWZyZXNoKCkge1xuICAgICAgICBpZiAodGhpcy5yZWZyZXNoUHJvbWlzZSkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnJlZnJlc2hQcm9taXNlKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaFByb21pc2UgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXNDaGFuZ2VkKGlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmZzLmluQXJyYXkoaWQsIHRoaXMuY2hhbmdlZERhdGEpID09PSAtMSkgPyBmYWxzZSA6IHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQSBkdW1teSBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgbGlvbkZuIHVudGlsIHRoZSByZXNwb25zZSBpcyByZWNlaXZlZCBhbmQgdGhlIExJT05cbiAgICAgKiBidW5kbGUgaXMgcmVjZWl2ZWQgZnJvbSB0aGUgV2ViU29ja2V0XG4gICAgICovXG4gICAgZHVtbXlMaW9uKGtleTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICclJyArIGtleSArICclJztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGFuZ2UgdGhlIHNvcnQgb3JkZXIgb2YgdGhlIGRhdGEgcmV0dXJuZWRcbiAgICAgKlxuICAgICAqIHNvcnRQYXJhbXMgYXJlIHBhc3NlZCB0byB0aGUgc2VydmVyIGJ5IFdlYlNvY2tldCBhbmQgdGhlIGRhdGEgaXNcbiAgICAgKiByZXR1cm5lZCBzb3J0ZWRcbiAgICAgKlxuICAgICAqIFRoaXMgaXMgdXN1YWxseSBhc3NpZ25lZCB0byB0aGUgKGNsaWNrKSBldmVudCBvbiBhIGNvbHVtbiwgYW5kIHRoZSBjb2x1bW5cbiAgICAgKiBuYW1lIHBhc3NlZCBpbiBlLmcuIChjbGljayk9XCJvblNvcnQoJ29yaWdpbicpXG4gICAgICogSWYgdGhlIGNvbHVtbiB0aGF0IGlzIHBhc3NlZCBpbiBpcyBhbHJlYWR5IHRoZSBmaXJzdENvbCwgdGhlbiByZXZlcnNlIGl0cyBkaXJlY3Rpb25cbiAgICAgKiBJZiBhIG5ldyBjb2x1bW4gaXMgcGFzc2VkIGluLCB0aGVuIG1ha2UgdGhlIGV4aXN0aW5nIGNvbCB0aGUgMm5kIHNvcnQgb3JkZXJcbiAgICAgKi9cbiAgICBvblNvcnQoY29sTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLnNvcnRQYXJhbXMuZmlyc3RDb2wgPT09IGNvbE5hbWUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvcnRQYXJhbXMuZmlyc3REaXIgPT09IFNvcnREaXIuZGVzYykge1xuICAgICAgICAgICAgICAgIHRoaXMuc29ydFBhcmFtcy5maXJzdERpciA9IFNvcnREaXIuYXNjO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zb3J0UGFyYW1zLmZpcnN0RGlyID0gU29ydERpci5kZXNjO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc29ydFBhcmFtcy5zZWNvbmRDb2wgPSB0aGlzLnNvcnRQYXJhbXMuZmlyc3RDb2w7XG4gICAgICAgICAgICB0aGlzLnNvcnRQYXJhbXMuc2Vjb25kRGlyID0gdGhpcy5zb3J0UGFyYW1zLmZpcnN0RGlyO1xuICAgICAgICAgICAgdGhpcy5zb3J0UGFyYW1zLmZpcnN0Q29sID0gY29sTmFtZTtcbiAgICAgICAgICAgIHRoaXMuc29ydFBhcmFtcy5maXJzdERpciA9IFNvcnREaXIuZGVzYztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnU29ydCBwYXJhbXMnLCB0aGlzLnNvcnRQYXJhbXMpO1xuICAgICAgICB0aGlzLnJlcXVlc3RUYWJsZURhdGEoKTtcbiAgICB9XG5cbiAgICBzb3J0SWNvbihjb2x1bW46IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLnNvcnRQYXJhbXMuZmlyc3RDb2wgPT09IGNvbHVtbikge1xuICAgICAgICAgICAgaWYgKHRoaXMuc29ydFBhcmFtcy5maXJzdERpciA9PT0gU29ydERpci5hc2MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3VwQXJyb3cnO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2Rvd25BcnJvdyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZS1zZWxlY3RzIHRoZSByb3dcbiAgICAgKi9cbiAgICBkZXNlbGVjdFJvdyhldmVudCkge1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnRGV0YWlscyBwYW5lbCBjbG9zZSBldmVudCcpO1xuICAgICAgICB0aGlzLnNlbElkID0gZXZlbnQ7XG4gICAgfVxufVxuIl19