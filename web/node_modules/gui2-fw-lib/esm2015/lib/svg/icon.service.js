/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/*
 * Copyright 2018-present Open Networking Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { GlyphService } from './glyph.service';
import { LogService } from '../log.service';
import { SvgUtilService } from './svgutil.service';
import * as d3 from 'd3';
import * as i0 from "@angular/core";
import * as i1 from "./glyph.service";
import * as i2 from "../log.service";
import * as i3 from "./svgutil.service";
/** @type {?} */
const vboxSize = 50;
/** @type {?} */
const cornerSize = vboxSize / 10;
/** @type {?} */
const viewBox = '0 0 ' + vboxSize + ' ' + vboxSize;
/** @type {?} */
export const glyphMapping = new Map([
    // Maps icon ID to the glyph ID it uses.
    // NOTE: icon ID maps to a CSS class for styling that icon
    ['active', 'checkMark'],
    ['inactive', 'xMark'],
    ['plus', 'plus'],
    ['minus', 'minus'],
    ['play', 'play'],
    ['stop', 'stop'],
    ['upload', 'upload'],
    ['download', 'download'],
    ['delta', 'delta'],
    ['nonzero', 'nonzero'],
    ['close', 'xClose'],
    ['m_cloud', 'm_cloud'],
    ['m_map', 'm_map'],
    ['m_selectMap', 'm_selectMap'],
    ['thatsNoMoon', 'thatsNoMoon'],
    ['m_ports', 'm_ports'],
    ['m_switch', 'm_switch'],
    ['m_roadm', 'm_roadm'],
    ['m_router', 'm_router'],
    ['m_uiAttached', 'm_uiAttached'],
    ['m_endstation', 'm_endstation'],
    ['m_summary', 'm_summary'],
    ['m_details', 'm_details'],
    ['m_oblique', 'm_oblique'],
    ['m_filters', 'm_filters'],
    ['m_cycleLabels', 'm_cycleLabels'],
    ['m_cycleGridDisplay', 'm_cycleGridDisplay'],
    ['m_prev', 'm_prev'],
    ['m_next', 'm_next'],
    ['m_flows', 'm_flows'],
    ['m_allTraffic', 'm_allTraffic'],
    ['m_xMark', 'm_xMark'],
    ['m_resetZoom', 'm_resetZoom'],
    ['m_eqMaster', 'm_eqMaster'],
    ['m_unknown', 'm_unknown'],
    ['m_controller', 'm_controller'],
    ['m_eqMaster', 'm_eqMaster'],
    ['m_virtual', 'm_virtual'],
    ['m_other', 'm_other'],
    ['m_bgpSpeaker', 'm_bgpSpeaker'],
    ['m_otn', 'm_otn'],
    ['m_roadm_otn', 'm_roadm_otn'],
    ['m_fiberSwitch', 'm_fiberSwitch'],
    ['m_microwave', 'm_microwave'],
    ['m_relatedIntents', 'm_relatedIntents'],
    ['m_intentTraffic', 'm_intentTraffic'],
    ['m_firewall', 'm_firewall'],
    ['m_balancer', 'm_balancer'],
    ['m_ips', 'm_ips'],
    ['m_ids', 'm_ids'],
    ['m_olt', 'm_olt'],
    ['m_onu', 'm_onu'],
    ['m_swap', 'm_swap'],
    ['m_shortestGeoPath', 'm_shortestGeoPath'],
    ['m_source', 'm_source'],
    ['m_destination', 'm_destination'],
    ['m_topo', 'm_topo'],
    ['m_shortestPath', 'm_shortestPath'],
    ['m_disjointPaths', 'm_disjointPaths'],
    ['m_region', 'm_region'],
    ['topo', 'topo'],
    ['bird', 'bird'],
    ['refresh', 'refresh'],
    ['query', 'query'],
    ['garbage', 'garbage'],
    ['upArrow', 'triangleUp'],
    ['downArrow', 'triangleDown'],
    ['triangleLeft', 'triangleLeft'],
    ['triangleRight', 'triangleRight'],
    ['appInactive', 'unknown'],
    ['uiAttached', 'uiAttached'],
    ['node', 'node'],
    ['devIcon_SWITCH', 'switch'],
    ['devIcon_ROADM', 'roadm'],
    ['devIcon_OTN', 'otn'],
    ['portIcon_DEFAULT', 'm_ports'],
    ['meter', 'meterTable'],
    ['deviceTable', 'switch'],
    ['flowTable', 'flowTable'],
    ['portTable', 'portTable'],
    ['groupTable', 'groupTable'],
    ['meterTable', 'meterTable'],
    ['pipeconfTable', 'pipeconfTable'],
    ['hostIcon_endstation', 'endstation'],
    ['hostIcon_router', 'router'],
    ['hostIcon_bgpSpeaker', 'bgpSpeaker'],
    // navigation menu icons...
    ['nav_apps', 'bird'],
    ['nav_settings', 'cog'],
    ['nav_cluster', 'node'],
    ['nav_processors', 'allTraffic'],
    ['nav_partitions', 'unknown'],
    ['nav_topo', 'topo'],
    ['nav_topo2', 'm_cloud'],
    ['nav_devs', 'switch'],
    ['nav_links', 'ports'],
    ['nav_hosts', 'endstation'],
    ['nav_intents', 'relatedIntents'],
    ['nav_tunnels', 'ports'],
    ['nav_yang', 'yang'],
]);
/**
 * ONOS GUI -- SVG -- Icon Service
 */
export class IconService {
    /**
     * @param {?} gs
     * @param {?} log
     * @param {?} sus
     */
    constructor(gs, log, sus) {
        this.gs = gs;
        this.log = log;
        this.sus = sus;
        this.log.debug('IconService constructed');
    }
    /**
     * @return {?}
     */
    ensureIconLibDefs() {
        /** @type {?} */
        const body = d3.select('body');
        /** @type {?} */
        let svg = body.select('svg#IconLibDefs');
        if (svg.empty()) {
            svg = body.append('svg').attr('id', 'IconLibDefs');
            svg.append('defs');
        }
        return svg.select('defs');
    }
    /**
     * Load an icon
     *
     * @param {?} div A D3 selection of the '&lt;div&gt;' element into which icon should load
     * @param {?=} glyphId Identifies the glyph to use
     * @param {?=} size The dimension of icon in pixels. Defaults to 20.
     * @param {?=} installGlyph If truthy, will cause the glyph to be added to
     *      well-known defs element. Defaults to false.
     * @param {?=} svgClass The CSS class used to identify the SVG layer.
     *      Defaults to 'embeddedIcon'.
     * @return {?}
     */
    loadIcon(div, glyphId = 'unknown', size = 20, installGlyph = true, svgClass = 'embeddedIcon') {
        /** @type {?} */
        const dim = size || 20;
        /** @type {?} */
        const svgCls = svgClass || 'embeddedIcon';
        /** @type {?} */
        const gid = glyphId || 'unknown';
        /** @type {?} */
        let g;
        /** @type {?} */
        let svgIcon;
        if (installGlyph) {
            this.gs.loadDefs(this.ensureIconLibDefs(), [gid], true);
        }
        this.log.warn('loadEmbeddedIcon. install done');
        svgIcon = div
            .append('svg')
            .attr('class', svgCls)
            .attr('width', dim)
            .attr('height', dim)
            .attr('viewBox', viewBox);
        g = svgIcon.append('g')
            .attr('class', 'icon');
        g.append('rect')
            .attr('width', vboxSize)
            .attr('height', vboxSize)
            .attr('rx', cornerSize);
        g.append('use')
            .attr('width', vboxSize)
            .attr('height', vboxSize)
            .attr('class', 'glyph')
            .attr('xlink:href', '#' + gid);
    }
    /**
     * Load an icon by class.
     * @param {?} div A D3 selection of the <DIV> element into which icon should load
     * @param {?} iconCls The CSS class used to identify the icon
     * @param {?} size The dimension of icon in pixels. Defaults to 20.
     * @param {?} installGlyph If truthy, will cause the glyph to be added to
     *      well-known defs element. Defaults to false.
     * @param {?=} svgClass The CSS class used to identify the SVG layer.
     *      Defaults to 'embeddedIcon'.
     * @return {?}
     */
    loadIconByClass(div, iconCls, size, installGlyph, svgClass = 'embeddedIcon') {
        this.loadIcon(div, glyphMapping.get(iconCls), size, installGlyph, svgClass);
        div.select('svg g').classed(iconCls, true);
    }
    /**
     * Load an embedded icon.
     * @param {?} div
     * @param {?} iconCls
     * @param {?} size
     * @return {?}
     */
    loadEmbeddedIcon(div, iconCls, size) {
        this.loadIconByClass(div, iconCls, size, true);
    }
    /**
     * Load an icon only to the svg defs collection
     *
     * Note: This is added for use with IconComponent, where the icon's
     * svg element is defined in the component template (and not built
     * inline using d3 manipulation
     *
     * @param {?} iconCls The icon class as a string
     * @return {?}
     */
    loadIconDef(iconCls) {
        /** @type {?} */
        let glyphName = glyphMapping.get(iconCls);
        if (!glyphName) {
            glyphName = iconCls;
        }
        this.gs.loadDefs(this.ensureIconLibDefs(), [glyphName], true);
        this.log.debug('icon definition', iconCls, 'added to defs');
    }
    /**
     * Add a device icon
     *
     * Adds a device glyph to the specified element.
     * Returns the D3 selection of the glyph (use) element.
     * @param {?} elem
     * @param {?} glyphId
     * @param {?} iconDim
     * @return {?}
     */
    addDeviceIcon(elem, glyphId, iconDim) {
        /** @type {?} */
        const gid = this.gs.glyphDefined(glyphId) ? glyphId : 'query';
        return elem.append('use').attr({
            'xlink:href': '#' + gid,
            width: iconDim,
            height: iconDim,
        });
    }
    /**
     * @param {?} elem
     * @param {?} radius
     * @param {?} glyphId
     * @return {?}
     */
    addHostIcon(elem, radius, glyphId) {
        /** @type {?} */
        const dim = radius * 1.5;
        /** @type {?} */
        const xlate = -dim / 2;
        /** @type {?} */
        const g = elem.append('g')
            .attr('class', 'svgIcon hostIcon');
        g.append('circle').attr('r', radius);
        g.append('use').attr({
            'xlink:href': '#' + glyphId,
            width: dim,
            height: dim,
            transform: this.sus.translate([xlate], xlate),
        });
        return g;
    }
    /**
     * @param {?} iconId
     * @param {?} glyphId
     * @return {?}
     */
    registerIconMapping(iconId, glyphId) {
        if (glyphMapping[iconId]) {
            this.log.warn('Icon with id', iconId, 'already mapped. Ignoring.');
        }
        else {
            // map icon-->glyph
            glyphMapping[iconId] = glyphId;
            // make sure definition is installed
            this.gs.loadDefs(this.ensureIconLibDefs(), [glyphId], true);
        }
    }
}
IconService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
            },] },
];
/** @nocollapse */
IconService.ctorParameters = () => [
    { type: GlyphService },
    { type: LogService },
    { type: SvgUtilService }
];
/** @nocollapse */ IconService.ngInjectableDef = i0.defineInjectable({ factory: function IconService_Factory() { return new IconService(i0.inject(i1.GlyphService), i0.inject(i2.LogService), i0.inject(i3.SvgUtilService)); }, token: IconService, providedIn: "root" });
if (false) {
    /** @type {?} */
    IconService.prototype.gs;
    /** @type {?} */
    IconService.prototype.log;
    /** @type {?} */
    IconService.prototype.sus;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWNvbi5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vZ3VpMi1mdy1saWIvIiwic291cmNlcyI6WyJsaWIvc3ZnL2ljb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNuRCxPQUFPLEtBQUssRUFBRSxNQUFNLElBQUksQ0FBQzs7Ozs7O01BRW5CLFFBQVEsR0FBRyxFQUFFOztNQUNiLFVBQVUsR0FBRyxRQUFRLEdBQUcsRUFBRTs7TUFDMUIsT0FBTyxHQUFHLE1BQU0sR0FBRyxRQUFRLEdBQUcsR0FBRyxHQUFHLFFBQVE7O0FBRWxELE1BQU0sT0FBTyxZQUFZLEdBQUcsSUFBSSxHQUFHLENBQWlCO0lBQ2hELHdDQUF3QztJQUN4QywwREFBMEQ7SUFDMUQsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDO0lBQ3ZCLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQztJQUVyQixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7SUFDaEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO0lBQ2xCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztJQUNoQixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7SUFFaEIsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDO0lBQ3BCLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztJQUN4QixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUM7SUFDbEIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ3RCLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQztJQUVuQixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDdEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO0lBQ2xCLENBQUMsYUFBYSxFQUFFLGFBQWEsQ0FBQztJQUM5QixDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUM7SUFDOUIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ3RCLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztJQUN4QixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDdEIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDO0lBQ3hCLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQztJQUNoQyxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUM7SUFDaEMsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDO0lBQzFCLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQztJQUMxQixDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUM7SUFDMUIsQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDO0lBQzFCLENBQUMsZUFBZSxFQUFFLGVBQWUsQ0FBQztJQUNsQyxDQUFDLG9CQUFvQixFQUFFLG9CQUFvQixDQUFDO0lBQzVDLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQztJQUNwQixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUM7SUFDcEIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ3RCLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQztJQUNoQyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDdEIsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDO0lBQzlCLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQztJQUM1QixDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUM7SUFDMUIsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDO0lBQ2hDLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQztJQUM1QixDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUM7SUFDMUIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ3RCLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQztJQUNoQyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUM7SUFDbEIsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDO0lBQzlCLENBQUMsZUFBZSxFQUFFLGVBQWUsQ0FBQztJQUNsQyxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUM7SUFDOUIsQ0FBQyxrQkFBa0IsRUFBRSxrQkFBa0IsQ0FBQztJQUN4QyxDQUFDLGlCQUFpQixFQUFFLGlCQUFpQixDQUFDO0lBQ3RDLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQztJQUM1QixDQUFDLFlBQVksRUFBRSxZQUFZLENBQUM7SUFDNUIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO0lBQ2xCLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQztJQUNsQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUM7SUFDbEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO0lBQ2xCLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQztJQUNwQixDQUFDLG1CQUFtQixFQUFFLG1CQUFtQixDQUFDO0lBQzFDLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztJQUN4QixDQUFDLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFDbEMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDO0lBQ3BCLENBQUMsZ0JBQWdCLEVBQUUsZ0JBQWdCLENBQUM7SUFDcEMsQ0FBQyxpQkFBaUIsRUFBRSxpQkFBaUIsQ0FBQztJQUN0QyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7SUFFeEIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO0lBQ2hCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztJQUVoQixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDdEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDO0lBQ2xCLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQztJQUd0QixDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUM7SUFDekIsQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDO0lBQzdCLENBQUMsY0FBYyxFQUFFLGNBQWMsQ0FBQztJQUNoQyxDQUFDLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFFbEMsQ0FBQyxhQUFhLEVBQUUsU0FBUyxDQUFDO0lBQzFCLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQztJQUU1QixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUM7SUFDaEIsQ0FBQyxnQkFBZ0IsRUFBRSxRQUFRLENBQUM7SUFDNUIsQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDO0lBQzFCLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQztJQUV0QixDQUFDLGtCQUFrQixFQUFFLFNBQVMsQ0FBQztJQUUvQixDQUFDLE9BQU8sRUFBRSxZQUFZLENBQUM7SUFFdkIsQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDO0lBQ3pCLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQztJQUMxQixDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUM7SUFDMUIsQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDO0lBQzVCLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQztJQUM1QixDQUFDLGVBQWUsRUFBRSxlQUFlLENBQUM7SUFFbEMsQ0FBQyxxQkFBcUIsRUFBRSxZQUFZLENBQUM7SUFDckMsQ0FBQyxpQkFBaUIsRUFBRSxRQUFRLENBQUM7SUFDN0IsQ0FBQyxxQkFBcUIsRUFBRSxZQUFZLENBQUM7SUFFckMsMkJBQTJCO0lBQzNCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQztJQUNwQixDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUM7SUFDdkIsQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDO0lBQ3ZCLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxDQUFDO0lBQ2hDLENBQUMsZ0JBQWdCLEVBQUUsU0FBUyxDQUFDO0lBRTdCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQztJQUNwQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUM7SUFDeEIsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDO0lBQ3RCLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQztJQUN0QixDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUM7SUFDM0IsQ0FBQyxhQUFhLEVBQUUsZ0JBQWdCLENBQUM7SUFDakMsQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDO0lBQ3hCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQztDQUN2QixDQUFDOzs7O0FBUUYsTUFBTSxPQUFPLFdBQVc7Ozs7OztJQUVwQixZQUNZLEVBQWdCLEVBQ2hCLEdBQWUsRUFDZixHQUFtQjtRQUZuQixPQUFFLEdBQUYsRUFBRSxDQUFjO1FBQ2hCLFFBQUcsR0FBSCxHQUFHLENBQVk7UUFDZixRQUFHLEdBQUgsR0FBRyxDQUFnQjtRQUczQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Ozs7SUFFRCxpQkFBaUI7O2NBQ1AsSUFBSSxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDOztZQUMxQixHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQztRQUN4QyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNiLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFDbkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUN0QjtRQUNELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5QixDQUFDOzs7Ozs7Ozs7Ozs7O0lBYUQsUUFBUSxDQUFDLEdBQUcsRUFBRSxVQUFrQixTQUFTLEVBQUUsT0FBZSxFQUFFLEVBQUUsZUFBd0IsSUFBSSxFQUFFLFdBQW1CLGNBQWM7O2NBQ25ILEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRTs7Y0FDaEIsTUFBTSxHQUFHLFFBQVEsSUFBSSxjQUFjOztjQUNuQyxHQUFHLEdBQUcsT0FBTyxJQUFJLFNBQVM7O1lBQzVCLENBQUM7O1lBQ0QsT0FBWTtRQUVoQixJQUFJLFlBQVksRUFBRTtZQUNkLElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDM0Q7UUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1FBRWhELE9BQU8sR0FBRyxHQUFHO2FBQ1IsTUFBTSxDQUFDLEtBQUssQ0FBQzthQUNiLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDO2FBQ3JCLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDO2FBQ2xCLElBQUksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDO2FBQ25CLElBQUksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFFOUIsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO2FBQ2xCLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFM0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7YUFDWCxJQUFJLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQzthQUN2QixJQUFJLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQzthQUN4QixJQUFJLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRTVCLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO2FBQ1YsSUFBSSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUM7YUFDdkIsSUFBSSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUM7YUFDeEIsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUM7YUFDdEIsSUFBSSxDQUFDLFlBQVksRUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDdkMsQ0FBQzs7Ozs7Ozs7Ozs7O0lBWUQsZUFBZSxDQUFDLEdBQUcsRUFBRSxPQUFlLEVBQUUsSUFBWSxFQUFFLFlBQXFCLEVBQUUsUUFBUSxHQUFFLGNBQWM7UUFDL0YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsWUFBWSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVFLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMvQyxDQUFDOzs7Ozs7OztJQUtELGdCQUFnQixDQUFDLEdBQUcsRUFBRSxPQUFlLEVBQUUsSUFBWTtRQUMvQyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25ELENBQUM7Ozs7Ozs7Ozs7O0lBV0QsV0FBVyxDQUFDLE9BQWU7O1lBQ25CLFNBQVMsR0FBVyxZQUFZLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUNqRCxJQUFJLENBQUMsU0FBUyxFQUFFO1lBQ1osU0FBUyxHQUFHLE9BQU8sQ0FBQztTQUN2QjtRQUNELElBQUksQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7Ozs7Ozs7Ozs7O0lBU0QsYUFBYSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTzs7Y0FDMUIsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU87UUFDN0QsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztZQUMzQixZQUFZLEVBQUUsR0FBRyxHQUFHLEdBQUc7WUFDdkIsS0FBSyxFQUFFLE9BQU87WUFDZCxNQUFNLEVBQUUsT0FBTztTQUNsQixDQUFDLENBQUM7SUFDUCxDQUFDOzs7Ozs7O0lBRUQsV0FBVyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTzs7Y0FDdkIsR0FBRyxHQUFHLE1BQU0sR0FBRyxHQUFHOztjQUNsQixLQUFLLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQzs7Y0FDaEIsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO2FBQ2pCLElBQUksQ0FBQyxPQUFPLEVBQUUsa0JBQWtCLENBQUM7UUFFMUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRXJDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ2pCLFlBQVksRUFBRSxHQUFHLEdBQUcsT0FBTztZQUMzQixLQUFLLEVBQUUsR0FBRztZQUNWLE1BQU0sRUFBRSxHQUFHO1lBQ1gsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxDQUFDO1NBQ2hELENBQUMsQ0FBQztRQUNILE9BQU8sQ0FBQyxDQUFDO0lBQ2IsQ0FBQzs7Ozs7O0lBRUQsbUJBQW1CLENBQUMsTUFBTSxFQUFFLE9BQU87UUFDL0IsSUFBSSxZQUFZLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDdEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSwyQkFBMkIsQ0FBQyxDQUFDO1NBQ3RFO2FBQU07WUFDSCxtQkFBbUI7WUFDbkIsWUFBWSxDQUFDLE1BQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQztZQUMvQixvQ0FBb0M7WUFDcEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztTQUMvRDtJQUNMLENBQUM7OztZQXZKSixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7Ozs7WUF0SVEsWUFBWTtZQUNaLFVBQVU7WUFDVixjQUFjOzs7OztJQXdJZix5QkFBd0I7O0lBQ3hCLDBCQUF1Qjs7SUFDdkIsMEJBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAyMDE4LXByZXNlbnQgT3BlbiBOZXR3b3JraW5nIEZvdW5kYXRpb25cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdseXBoU2VydmljZSB9IGZyb20gJy4vZ2x5cGguc2VydmljZSc7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSAnLi4vbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3ZnVXRpbFNlcnZpY2UgfSBmcm9tICcuL3N2Z3V0aWwuc2VydmljZSc7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMyc7XG5cbmNvbnN0IHZib3hTaXplID0gNTA7XG5jb25zdCBjb3JuZXJTaXplID0gdmJveFNpemUgLyAxMDtcbmNvbnN0IHZpZXdCb3ggPSAnMCAwICcgKyB2Ym94U2l6ZSArICcgJyArIHZib3hTaXplO1xuXG5leHBvcnQgY29uc3QgZ2x5cGhNYXBwaW5nID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oW1xuICAgIC8vIE1hcHMgaWNvbiBJRCB0byB0aGUgZ2x5cGggSUQgaXQgdXNlcy5cbiAgICAvLyBOT1RFOiBpY29uIElEIG1hcHMgdG8gYSBDU1MgY2xhc3MgZm9yIHN0eWxpbmcgdGhhdCBpY29uXG4gICAgWydhY3RpdmUnLCAnY2hlY2tNYXJrJ10sXG4gICAgWydpbmFjdGl2ZScsICd4TWFyayddLFxuXG4gICAgWydwbHVzJywgJ3BsdXMnXSxcbiAgICBbJ21pbnVzJywgJ21pbnVzJ10sXG4gICAgWydwbGF5JywgJ3BsYXknXSxcbiAgICBbJ3N0b3AnLCAnc3RvcCddLFxuXG4gICAgWyd1cGxvYWQnLCAndXBsb2FkJ10sXG4gICAgWydkb3dubG9hZCcsICdkb3dubG9hZCddLFxuICAgIFsnZGVsdGEnLCAnZGVsdGEnXSxcbiAgICBbJ25vbnplcm8nLCAnbm9uemVybyddLFxuICAgIFsnY2xvc2UnLCAneENsb3NlJ10sXG5cbiAgICBbJ21fY2xvdWQnLCAnbV9jbG91ZCddLFxuICAgIFsnbV9tYXAnLCAnbV9tYXAnXSxcbiAgICBbJ21fc2VsZWN0TWFwJywgJ21fc2VsZWN0TWFwJ10sXG4gICAgWyd0aGF0c05vTW9vbicsICd0aGF0c05vTW9vbiddLFxuICAgIFsnbV9wb3J0cycsICdtX3BvcnRzJ10sXG4gICAgWydtX3N3aXRjaCcsICdtX3N3aXRjaCddLFxuICAgIFsnbV9yb2FkbScsICdtX3JvYWRtJ10sXG4gICAgWydtX3JvdXRlcicsICdtX3JvdXRlciddLFxuICAgIFsnbV91aUF0dGFjaGVkJywgJ21fdWlBdHRhY2hlZCddLFxuICAgIFsnbV9lbmRzdGF0aW9uJywgJ21fZW5kc3RhdGlvbiddLFxuICAgIFsnbV9zdW1tYXJ5JywgJ21fc3VtbWFyeSddLFxuICAgIFsnbV9kZXRhaWxzJywgJ21fZGV0YWlscyddLFxuICAgIFsnbV9vYmxpcXVlJywgJ21fb2JsaXF1ZSddLFxuICAgIFsnbV9maWx0ZXJzJywgJ21fZmlsdGVycyddLFxuICAgIFsnbV9jeWNsZUxhYmVscycsICdtX2N5Y2xlTGFiZWxzJ10sXG4gICAgWydtX2N5Y2xlR3JpZERpc3BsYXknLCAnbV9jeWNsZUdyaWREaXNwbGF5J10sXG4gICAgWydtX3ByZXYnLCAnbV9wcmV2J10sXG4gICAgWydtX25leHQnLCAnbV9uZXh0J10sXG4gICAgWydtX2Zsb3dzJywgJ21fZmxvd3MnXSxcbiAgICBbJ21fYWxsVHJhZmZpYycsICdtX2FsbFRyYWZmaWMnXSxcbiAgICBbJ21feE1hcmsnLCAnbV94TWFyayddLFxuICAgIFsnbV9yZXNldFpvb20nLCAnbV9yZXNldFpvb20nXSxcbiAgICBbJ21fZXFNYXN0ZXInLCAnbV9lcU1hc3RlciddLFxuICAgIFsnbV91bmtub3duJywgJ21fdW5rbm93biddLFxuICAgIFsnbV9jb250cm9sbGVyJywgJ21fY29udHJvbGxlciddLFxuICAgIFsnbV9lcU1hc3RlcicsICdtX2VxTWFzdGVyJ10sXG4gICAgWydtX3ZpcnR1YWwnLCAnbV92aXJ0dWFsJ10sXG4gICAgWydtX290aGVyJywgJ21fb3RoZXInXSxcbiAgICBbJ21fYmdwU3BlYWtlcicsICdtX2JncFNwZWFrZXInXSxcbiAgICBbJ21fb3RuJywgJ21fb3RuJ10sXG4gICAgWydtX3JvYWRtX290bicsICdtX3JvYWRtX290biddLFxuICAgIFsnbV9maWJlclN3aXRjaCcsICdtX2ZpYmVyU3dpdGNoJ10sXG4gICAgWydtX21pY3Jvd2F2ZScsICdtX21pY3Jvd2F2ZSddLFxuICAgIFsnbV9yZWxhdGVkSW50ZW50cycsICdtX3JlbGF0ZWRJbnRlbnRzJ10sXG4gICAgWydtX2ludGVudFRyYWZmaWMnLCAnbV9pbnRlbnRUcmFmZmljJ10sXG4gICAgWydtX2ZpcmV3YWxsJywgJ21fZmlyZXdhbGwnXSxcbiAgICBbJ21fYmFsYW5jZXInLCAnbV9iYWxhbmNlciddLFxuICAgIFsnbV9pcHMnLCAnbV9pcHMnXSxcbiAgICBbJ21faWRzJywgJ21faWRzJ10sXG4gICAgWydtX29sdCcsICdtX29sdCddLFxuICAgIFsnbV9vbnUnLCAnbV9vbnUnXSxcbiAgICBbJ21fc3dhcCcsICdtX3N3YXAnXSxcbiAgICBbJ21fc2hvcnRlc3RHZW9QYXRoJywgJ21fc2hvcnRlc3RHZW9QYXRoJ10sXG4gICAgWydtX3NvdXJjZScsICdtX3NvdXJjZSddLFxuICAgIFsnbV9kZXN0aW5hdGlvbicsICdtX2Rlc3RpbmF0aW9uJ10sXG4gICAgWydtX3RvcG8nLCAnbV90b3BvJ10sXG4gICAgWydtX3Nob3J0ZXN0UGF0aCcsICdtX3Nob3J0ZXN0UGF0aCddLFxuICAgIFsnbV9kaXNqb2ludFBhdGhzJywgJ21fZGlzam9pbnRQYXRocyddLFxuICAgIFsnbV9yZWdpb24nLCAnbV9yZWdpb24nXSxcblxuICAgIFsndG9wbycsICd0b3BvJ10sXG4gICAgWydiaXJkJywgJ2JpcmQnXSxcblxuICAgIFsncmVmcmVzaCcsICdyZWZyZXNoJ10sXG4gICAgWydxdWVyeScsICdxdWVyeSddLFxuICAgIFsnZ2FyYmFnZScsICdnYXJiYWdlJ10sXG5cblxuICAgIFsndXBBcnJvdycsICd0cmlhbmdsZVVwJ10sXG4gICAgWydkb3duQXJyb3cnLCAndHJpYW5nbGVEb3duJ10sXG4gICAgWyd0cmlhbmdsZUxlZnQnLCAndHJpYW5nbGVMZWZ0J10sXG4gICAgWyd0cmlhbmdsZVJpZ2h0JywgJ3RyaWFuZ2xlUmlnaHQnXSxcblxuICAgIFsnYXBwSW5hY3RpdmUnLCAndW5rbm93biddLFxuICAgIFsndWlBdHRhY2hlZCcsICd1aUF0dGFjaGVkJ10sXG5cbiAgICBbJ25vZGUnLCAnbm9kZSddLFxuICAgIFsnZGV2SWNvbl9TV0lUQ0gnLCAnc3dpdGNoJ10sXG4gICAgWydkZXZJY29uX1JPQURNJywgJ3JvYWRtJ10sXG4gICAgWydkZXZJY29uX09UTicsICdvdG4nXSxcblxuICAgIFsncG9ydEljb25fREVGQVVMVCcsICdtX3BvcnRzJ10sXG5cbiAgICBbJ21ldGVyJywgJ21ldGVyVGFibGUnXSwgLy8gVE9ETzogbV9tZXRlciBpY29uP1xuXG4gICAgWydkZXZpY2VUYWJsZScsICdzd2l0Y2gnXSxcbiAgICBbJ2Zsb3dUYWJsZScsICdmbG93VGFibGUnXSxcbiAgICBbJ3BvcnRUYWJsZScsICdwb3J0VGFibGUnXSxcbiAgICBbJ2dyb3VwVGFibGUnLCAnZ3JvdXBUYWJsZSddLFxuICAgIFsnbWV0ZXJUYWJsZScsICdtZXRlclRhYmxlJ10sXG4gICAgWydwaXBlY29uZlRhYmxlJywgJ3BpcGVjb25mVGFibGUnXSxcblxuICAgIFsnaG9zdEljb25fZW5kc3RhdGlvbicsICdlbmRzdGF0aW9uJ10sXG4gICAgWydob3N0SWNvbl9yb3V0ZXInLCAncm91dGVyJ10sXG4gICAgWydob3N0SWNvbl9iZ3BTcGVha2VyJywgJ2JncFNwZWFrZXInXSxcblxuICAgIC8vIG5hdmlnYXRpb24gbWVudSBpY29ucy4uLlxuICAgIFsnbmF2X2FwcHMnLCAnYmlyZCddLFxuICAgIFsnbmF2X3NldHRpbmdzJywgJ2NvZyddLFxuICAgIFsnbmF2X2NsdXN0ZXInLCAnbm9kZSddLFxuICAgIFsnbmF2X3Byb2Nlc3NvcnMnLCAnYWxsVHJhZmZpYyddLFxuICAgIFsnbmF2X3BhcnRpdGlvbnMnLCAndW5rbm93biddLFxuXG4gICAgWyduYXZfdG9wbycsICd0b3BvJ10sXG4gICAgWyduYXZfdG9wbzInLCAnbV9jbG91ZCddLFxuICAgIFsnbmF2X2RldnMnLCAnc3dpdGNoJ10sXG4gICAgWyduYXZfbGlua3MnLCAncG9ydHMnXSxcbiAgICBbJ25hdl9ob3N0cycsICdlbmRzdGF0aW9uJ10sXG4gICAgWyduYXZfaW50ZW50cycsICdyZWxhdGVkSW50ZW50cyddLFxuICAgIFsnbmF2X3R1bm5lbHMnLCAncG9ydHMnXSwgLy8gVE9ETzogdXNlIHR1bm5lbCBnbHlwaCwgd2hlbiBhdmFpbGFibGVcbiAgICBbJ25hdl95YW5nJywgJ3lhbmcnXSxcbl0pO1xuXG4vKipcbiAqIE9OT1MgR1VJIC0tIFNWRyAtLSBJY29uIFNlcnZpY2VcbiAqL1xuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIEljb25TZXJ2aWNlIHtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGdzOiBHbHlwaFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbG9nOiBMb2dTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHN1czogU3ZnVXRpbFNlcnZpY2VcbiAgICApIHtcblxuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnSWNvblNlcnZpY2UgY29uc3RydWN0ZWQnKTtcbiAgICB9XG5cbiAgICBlbnN1cmVJY29uTGliRGVmcygpIHtcbiAgICAgICAgY29uc3QgYm9keSA9IGQzLnNlbGVjdCgnYm9keScpO1xuICAgICAgICBsZXQgc3ZnID0gYm9keS5zZWxlY3QoJ3N2ZyNJY29uTGliRGVmcycpO1xuICAgICAgICBpZiAoc3ZnLmVtcHR5KCkpIHtcbiAgICAgICAgICAgIHN2ZyA9IGJvZHkuYXBwZW5kKCdzdmcnKS5hdHRyKCdpZCcsICdJY29uTGliRGVmcycpO1xuICAgICAgICAgICAgc3ZnLmFwcGVuZCgnZGVmcycpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdmcuc2VsZWN0KCdkZWZzJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhbiBpY29uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGl2IEEgRDMgc2VsZWN0aW9uIG9mIHRoZSAnJmx0O2RpdiZndDsnIGVsZW1lbnQgaW50byB3aGljaCBpY29uIHNob3VsZCBsb2FkXG4gICAgICogQHBhcmFtIGdseXBoSWQgSWRlbnRpZmllcyB0aGUgZ2x5cGggdG8gdXNlXG4gICAgICogQHBhcmFtIHNpemUgVGhlIGRpbWVuc2lvbiBvZiBpY29uIGluIHBpeGVscy4gRGVmYXVsdHMgdG8gMjAuXG4gICAgICogQHBhcmFtIGluc3RhbGxHbHlwaCBJZiB0cnV0aHksIHdpbGwgY2F1c2UgdGhlIGdseXBoIHRvIGJlIGFkZGVkIHRvXG4gICAgICogICAgICB3ZWxsLWtub3duIGRlZnMgZWxlbWVudC4gRGVmYXVsdHMgdG8gZmFsc2UuXG4gICAgICogQHBhcmFtIHN2Z0NsYXNzIFRoZSBDU1MgY2xhc3MgdXNlZCB0byBpZGVudGlmeSB0aGUgU1ZHIGxheWVyLlxuICAgICAqICAgICAgRGVmYXVsdHMgdG8gJ2VtYmVkZGVkSWNvbicuXG4gICAgICovXG4gICAgbG9hZEljb24oZGl2LCBnbHlwaElkOiBzdHJpbmcgPSAndW5rbm93bicsIHNpemU6IG51bWJlciA9IDIwLCBpbnN0YWxsR2x5cGg6IGJvb2xlYW4gPSB0cnVlLCBzdmdDbGFzczogc3RyaW5nID0gJ2VtYmVkZGVkSWNvbicpIHtcbiAgICAgICAgY29uc3QgZGltID0gc2l6ZSB8fCAyMDtcbiAgICAgICAgY29uc3Qgc3ZnQ2xzID0gc3ZnQ2xhc3MgfHwgJ2VtYmVkZGVkSWNvbic7XG4gICAgICAgIGNvbnN0IGdpZCA9IGdseXBoSWQgfHwgJ3Vua25vd24nO1xuICAgICAgICBsZXQgZztcbiAgICAgICAgbGV0IHN2Z0ljb246IGFueTtcblxuICAgICAgICBpZiAoaW5zdGFsbEdseXBoKSB7XG4gICAgICAgICAgICB0aGlzLmdzLmxvYWREZWZzKHRoaXMuZW5zdXJlSWNvbkxpYkRlZnMoKSwgW2dpZF0sIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9nLndhcm4oJ2xvYWRFbWJlZGRlZEljb24uIGluc3RhbGwgZG9uZScpO1xuXG4gICAgICAgIHN2Z0ljb24gPSBkaXZcbiAgICAgICAgICAgIC5hcHBlbmQoJ3N2ZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCBzdmdDbHMpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCBkaW0pXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgZGltKVxuICAgICAgICAgICAgLmF0dHIoJ3ZpZXdCb3gnLCB2aWV3Qm94KTtcblxuICAgICAgICBnID0gc3ZnSWNvbi5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2ljb24nKTtcblxuICAgICAgICBnLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCB2Ym94U2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCB2Ym94U2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKCdyeCcsIGNvcm5lclNpemUpO1xuXG4gICAgICAgIGcuYXBwZW5kKCd1c2UnKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgdmJveFNpemUpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgdmJveFNpemUpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnZ2x5cGgnKVxuICAgICAgICAgICAgLmF0dHIoJ3hsaW5rOmhyZWYnLCAnIycgKyBnaWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvYWQgYW4gaWNvbiBieSBjbGFzcy5cbiAgICAgKiBAcGFyYW0gZGl2IEEgRDMgc2VsZWN0aW9uIG9mIHRoZSA8RElWPiBlbGVtZW50IGludG8gd2hpY2ggaWNvbiBzaG91bGQgbG9hZFxuICAgICAqIEBwYXJhbSBpY29uQ2xzIFRoZSBDU1MgY2xhc3MgdXNlZCB0byBpZGVudGlmeSB0aGUgaWNvblxuICAgICAqIEBwYXJhbSBzaXplIFRoZSBkaW1lbnNpb24gb2YgaWNvbiBpbiBwaXhlbHMuIERlZmF1bHRzIHRvIDIwLlxuICAgICAqIEBwYXJhbSBpbnN0YWxsR2x5cGggSWYgdHJ1dGh5LCB3aWxsIGNhdXNlIHRoZSBnbHlwaCB0byBiZSBhZGRlZCB0b1xuICAgICAqICAgICAgd2VsbC1rbm93biBkZWZzIGVsZW1lbnQuIERlZmF1bHRzIHRvIGZhbHNlLlxuICAgICAqIEBwYXJhbSBzdmdDbGFzcyBUaGUgQ1NTIGNsYXNzIHVzZWQgdG8gaWRlbnRpZnkgdGhlIFNWRyBsYXllci5cbiAgICAgKiAgICAgIERlZmF1bHRzIHRvICdlbWJlZGRlZEljb24nLlxuICAgICAqL1xuICAgIGxvYWRJY29uQnlDbGFzcyhkaXYsIGljb25DbHM6IHN0cmluZywgc2l6ZTogbnVtYmVyLCBpbnN0YWxsR2x5cGg6IGJvb2xlYW4sIHN2Z0NsYXNzPSAnZW1iZWRkZWRJY29uJykge1xuICAgICAgICB0aGlzLmxvYWRJY29uKGRpdiwgZ2x5cGhNYXBwaW5nLmdldChpY29uQ2xzKSwgc2l6ZSwgaW5zdGFsbEdseXBoLCBzdmdDbGFzcyk7XG4gICAgICAgIGRpdi5zZWxlY3QoJ3N2ZyBnJykuY2xhc3NlZChpY29uQ2xzLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIGFuIGVtYmVkZGVkIGljb24uXG4gICAgICovXG4gICAgbG9hZEVtYmVkZGVkSWNvbihkaXYsIGljb25DbHM6IHN0cmluZywgc2l6ZTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubG9hZEljb25CeUNsYXNzKGRpdiwgaWNvbkNscywgc2l6ZSwgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZCBhbiBpY29uIG9ubHkgdG8gdGhlIHN2ZyBkZWZzIGNvbGxlY3Rpb25cbiAgICAgKlxuICAgICAqIE5vdGU6IFRoaXMgaXMgYWRkZWQgZm9yIHVzZSB3aXRoIEljb25Db21wb25lbnQsIHdoZXJlIHRoZSBpY29uJ3NcbiAgICAgKiBzdmcgZWxlbWVudCBpcyBkZWZpbmVkIGluIHRoZSBjb21wb25lbnQgdGVtcGxhdGUgKGFuZCBub3QgYnVpbHRcbiAgICAgKiBpbmxpbmUgdXNpbmcgZDMgbWFuaXB1bGF0aW9uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaWNvbkNscyBUaGUgaWNvbiBjbGFzcyBhcyBhIHN0cmluZ1xuICAgICAqL1xuICAgIGxvYWRJY29uRGVmKGljb25DbHM6IHN0cmluZyk6IHZvaWQge1xuICAgICAgICBsZXQgZ2x5cGhOYW1lOiBzdHJpbmcgPSBnbHlwaE1hcHBpbmcuZ2V0KGljb25DbHMpO1xuICAgICAgICBpZiAoIWdseXBoTmFtZSkge1xuICAgICAgICAgICAgZ2x5cGhOYW1lID0gaWNvbkNscztcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdzLmxvYWREZWZzKHRoaXMuZW5zdXJlSWNvbkxpYkRlZnMoKSwgW2dseXBoTmFtZV0sIHRydWUpO1xuICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnaWNvbiBkZWZpbml0aW9uJywgaWNvbkNscywgJ2FkZGVkIHRvIGRlZnMnKTtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIGRldmljZSBpY29uXG4gICAgICpcbiAgICAgKiBBZGRzIGEgZGV2aWNlIGdseXBoIHRvIHRoZSBzcGVjaWZpZWQgZWxlbWVudC5cbiAgICAgKiBSZXR1cm5zIHRoZSBEMyBzZWxlY3Rpb24gb2YgdGhlIGdseXBoICh1c2UpIGVsZW1lbnQuXG4gICAgICovXG4gICAgYWRkRGV2aWNlSWNvbihlbGVtLCBnbHlwaElkLCBpY29uRGltKSB7XG4gICAgICAgIGNvbnN0IGdpZCA9IHRoaXMuZ3MuZ2x5cGhEZWZpbmVkKGdseXBoSWQpID8gZ2x5cGhJZCA6ICdxdWVyeSc7XG4gICAgICAgIHJldHVybiBlbGVtLmFwcGVuZCgndXNlJykuYXR0cih7XG4gICAgICAgICAgICAneGxpbms6aHJlZic6ICcjJyArIGdpZCxcbiAgICAgICAgICAgIHdpZHRoOiBpY29uRGltLFxuICAgICAgICAgICAgaGVpZ2h0OiBpY29uRGltLFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhZGRIb3N0SWNvbihlbGVtLCByYWRpdXMsIGdseXBoSWQpIHtcbiAgICAgICAgY29uc3QgZGltID0gcmFkaXVzICogMS41O1xuICAgICAgICBjb25zdCB4bGF0ZSA9IC1kaW0gLyAyO1xuICAgICAgICBjb25zdCBnID0gZWxlbS5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdzdmdJY29uIGhvc3RJY29uJyk7XG5cbiAgICAgICAgZy5hcHBlbmQoJ2NpcmNsZScpLmF0dHIoJ3InLCByYWRpdXMpO1xuXG4gICAgICAgIGcuYXBwZW5kKCd1c2UnKS5hdHRyKHtcbiAgICAgICAgICAgICd4bGluazpocmVmJzogJyMnICsgZ2x5cGhJZCxcbiAgICAgICAgICAgIHdpZHRoOiBkaW0sXG4gICAgICAgICAgICBoZWlnaHQ6IGRpbSxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogdGhpcy5zdXMudHJhbnNsYXRlKFt4bGF0ZV0sIHhsYXRlKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBnO1xuICAgIH1cblxuICAgIHJlZ2lzdGVySWNvbk1hcHBpbmcoaWNvbklkLCBnbHlwaElkKSB7XG4gICAgICAgIGlmIChnbHlwaE1hcHBpbmdbaWNvbklkXSkge1xuICAgICAgICAgICAgdGhpcy5sb2cud2FybignSWNvbiB3aXRoIGlkJywgaWNvbklkLCAnYWxyZWFkeSBtYXBwZWQuIElnbm9yaW5nLicpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gbWFwIGljb24tLT5nbHlwaFxuICAgICAgICAgICAgZ2x5cGhNYXBwaW5nW2ljb25JZF0gPSBnbHlwaElkO1xuICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGRlZmluaXRpb24gaXMgaW5zdGFsbGVkXG4gICAgICAgICAgICB0aGlzLmdzLmxvYWREZWZzKHRoaXMuZW5zdXJlSWNvbkxpYkRlZnMoKSwgW2dseXBoSWRdLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==