/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
/*
 * Copyright 2018-present Open Networking Foundation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Input, Inject, NgZone } from '@angular/core';
import { Router } from '@angular/router';
import { LionService } from '../../util/lion.service';
import { LogService } from '../../log.service';
import { NavService } from '../../nav/nav.service';
import { WebSocketService } from '../../remote/websocket.service';
/**
 * ONOS GUI -- Masthead Component
 */
export class MastComponent {
    /**
     * @param {?} lion
     * @param {?} log
     * @param {?} ns
     * @param {?} wss
     * @param {?} router
     * @param {?} zone
     * @param {?} window
     */
    constructor(lion, log, ns, wss, router, zone, window) {
        this.lion = lion;
        this.log = log;
        this.ns = ns;
        this.wss = wss;
        this.router = router;
        this.zone = zone;
        this.window = window;
        // Function
        this.viewMap = new Map([]); // A map of app names
        // A map of app names
        this.confirmMessage = '';
        this.strongWarning = '';
        this.viewMap.set('apps', 'https://wiki.onosproject.org/display/ONOS/GUI+Application+View');
        this.viewMap.set('device', 'https://wiki.onosproject.org/display/ONOS/GUI+Device+View');
        this.viewMap.set('', 'https://wiki.onosproject.org/display/ONOS/The+ONOS+Web+GUI');
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (this.lion.ubercache.length === 0) {
            this.lionFn = this.dummyLion;
            this.lion.loadCbs.set('mast', () => this.doLion());
            this.log.debug('LION not available when MastComponent initialized');
        }
        else {
            this.doLion();
        }
        this.wss.bindHandlers(new Map([
            ['guiRemoved', (data) => this.triggerRefresh(data, false)],
            ['guiAdded', (data) => this.triggerRefresh(data, true)]
        ]));
        this.log.debug('MastComponent initialized');
    }
    /**
     * Nav component should never be closed, but in case it does, it's
     * safer to tidy up after itself
     * @return {?}
     */
    ngOnDestroy() {
        this.lion.loadCbs.delete('mast');
    }
    /**
     * Read the LION bundle for App and set up the lionFn
     * @return {?}
     */
    doLion() {
        this.lionFn = this.lion.bundle('core.fw.Mast');
        if (this.username === undefined) {
            this.username = this.lionFn('unknown_user');
        }
    }
    /**
     * A dummy implementation of the lionFn until the response is received and the LION
     * bundle is received from the WebSocket
     * @param {?} key
     * @return {?}
     */
    dummyLion(key) {
        return '%' + key + '%';
    }
    /**
     * @return {?}
     */
    directTo() {
        /** @type {?} */
        const curId = this.window.location.pathname.replace('/', '');
        /** @type {?} */
        let helpUrl = this.viewMap.get(curId);
        if (helpUrl === undefined) {
            helpUrl = this.viewMap.get('');
            this.log.warn('No help file linked for view:', curId);
        }
        this.window.open(helpUrl);
    }
    /**
     * @param {?} data
     * @param {?} added
     * @return {?}
     */
    triggerRefresh(data, added) {
        this.confirmMessage = this.lionFn(added ? 'uicomp_added' : 'uicomp_removed');
        this.log.debug('Refresh has been triggered - item', added ? 'added' : 'removed', ' - ', data);
    }
    /**
     * Callback when the Confirm dialog is shown and a choice is made
     * @param {?} choice
     * @return {?}
     */
    dOk(choice) {
        if (choice) {
            this.ns.getUiViews();
            this.router.navigate(['/']);
            this.zone.runOutsideAngular(() => {
                location.reload();
            });
            this.log.debug('Refresh confirmed'); // Will not be printed if page reloads
        }
        else {
            this.log.debug('Refresh cancelled');
        }
        this.confirmMessage = '';
        this.strongWarning = '';
    }
}
MastComponent.decorators = [
    { type: Component, args: [{
                selector: 'onos-mast',
                template: `<!--
~ Copyright 2018-present Open Networking Foundation
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~     http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->
<div id="mast-top-block"></div>
<!-- The mast-top-block is an inline display element that pushes any
  subsequent elements down the page. It has a height of 48px
     The mast block overlays the mast-top-block. It is is positioned
     absolutely so that the nav component can slide in behind it when
     not shown -->
<div id="mast" align="left">
    <span class="nav-menu-button clickable" (click)="ns.toggleNav()">
        <img src="data/img/nav-menu-mojo.png"/>
    </span>
    <img class="logo" src="data/img/masthead-logo-mojo.png">
    <onos-confirm title="{{ lionFn('ui_ok_to_update') }}" message="{{ confirmMessage }}" warning="{{ strongWarning }}" (chosen)="dOk($event)"></onos-confirm>
    <div id="mast-right">
        <nav>
            <div class="dropdown-parent">
                <a class="clickable user-menu__name">{{ username }} <i class="dropdown-icon"></i></a>
                <div class="dropdown">
                    <a href="rs/logout"> {{ lionFn('logout') }} </a>
                </div>
            </div>
            <div class="ctrl-btns">
                <div class="active clickable icon" (click)="directTo()">
                    <onos-icon iconId="query" iconSize="32" toolTip="{{ lionFn('tt_help') }}"></onos-icon>
                </div>
            </div>
        </nav>

    </div>
</div>
`,
                styles: [`#mast-top-block{display:block;z-index:-1;height:48px;width:100%}#mast{position:absolute;width:100%;top:0;height:48px;padding:0;z-index:10000}#mast a:hover{text-decoration:none}html[data-platform=iPad] #mast{padding-top:16px}#mast .nav-menu-button{display:inline-block;vertical-align:middle;text-align:center;line-height:48px;padding:0 12px;cursor:pointer;cursor:hand;font-size:0}#mast .nav-menu-button img{width:25px;vertical-align:middle}#mast .logo{height:47px;width:511px;vertical-align:bottom}#mast-right{display:inline-block;float:right;position:relative;top:0;padding-right:15px;line-height:48px}#mast-right div.ctrl-btns{float:right}#mast-right div.icon{box-sizing:border-box;position:relative;height:48px;width:48px;padding:9px}#mast .dropdown-parent{position:relative;float:right}#mast .dropdown-parent i.dropdown-icon{display:inline-block;height:7px;width:9px;margin-left:10px;background:url(data/img/dropdown-icon.png) no-repeat}#mast .dropdown{position:absolute;top:40px;right:-8px;display:none;min-width:100px;line-height:16px;font-size:12pt;z-index:1000}#mast .dropdown a{text-decoration:none;font-size:12px;display:block;padding:8px 16px 6px 12px}#mast .dropdown-parent:hover .dropdown{display:block}#mast .dropdown-parent:hover i.dropdown-icon{background-position-x:-14px}html[data-platform=iPad] #mast .dropdown{top:57px}`, `#mast{background-color:#231f20}#mast .nav-menu-button:hover{background-color:#888}#mast nav,#mast-right a{color:#009fdb}#mast .dropdown{background-color:#231f20;border:1px solid #ddd}#mast .dropdown a{color:#009fdb;border-bottom:1px solid #444}#mast .dropdown a:hover{color:#fff}`]
            },] },
];
/** @nocollapse */
MastComponent.ctorParameters = () => [
    { type: LionService },
    { type: LogService },
    { type: NavService },
    { type: WebSocketService },
    { type: Router },
    { type: NgZone },
    { type: undefined, decorators: [{ type: Inject, args: ['Window',] }] }
];
MastComponent.propDecorators = {
    username: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    MastComponent.prototype.username;
    /** @type {?} */
    MastComponent.prototype.lionFn;
    /** @type {?} */
    MastComponent.prototype.viewMap;
    /** @type {?} */
    MastComponent.prototype.confirmMessage;
    /** @type {?} */
    MastComponent.prototype.strongWarning;
    /** @type {?} */
    MastComponent.prototype.lion;
    /** @type {?} */
    MastComponent.prototype.log;
    /** @type {?} */
    MastComponent.prototype.ns;
    /** @type {?} */
    MastComponent.prototype.wss;
    /** @type {?} */
    MastComponent.prototype.router;
    /** @type {?} */
    MastComponent.prototype.zone;
    /** @type {?} */
    MastComponent.prototype.window;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9ndWkyLWZ3LWxpYi8iLCJzb3VyY2VzIjpbImxpYi9tYXN0L21hc3QvbWFzdC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7OztBQXNEbEUsTUFBTSxPQUFPLGFBQWE7Ozs7Ozs7Ozs7SUFRdEIsWUFDWSxJQUFpQixFQUNqQixHQUFlLEVBQ2hCLEVBQWMsRUFDYixHQUFxQixFQUNyQixNQUFjLEVBQ2QsSUFBWSxFQUNNLE1BQVc7UUFON0IsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUNqQixRQUFHLEdBQUgsR0FBRyxDQUFZO1FBQ2hCLE9BQUUsR0FBRixFQUFFLENBQVk7UUFDYixRQUFHLEdBQUgsR0FBRyxDQUFrQjtRQUNyQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUNNLFdBQU0sR0FBTixNQUFNLENBQUs7O1FBWHpDLFlBQU8sR0FBRyxJQUFJLEdBQUcsQ0FBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7O1FBQzVELG1CQUFjLEdBQVcsRUFBRSxDQUFDO1FBQzVCLGtCQUFhLEdBQVcsRUFBRSxDQUFDO1FBV3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0s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QUFxQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxOC1wcmVzZW50IE9wZW4gTmV0d29ya2luZyBGb3VuZGF0aW9uXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uRGVzdHJveSwgSW5qZWN0LCBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBMaW9uU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWwvbGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IExvZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9sb2cuc2VydmljZSc7XG5pbXBvcnQgeyBOYXZTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vbmF2L25hdi5zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICcuLi8uLi9yZW1vdGUvd2Vic29ja2V0LnNlcnZpY2UnO1xuXG4vKipcbiAqIE9OT1MgR1VJIC0tIE1hc3RoZWFkIENvbXBvbmVudFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdvbm9zLW1hc3QnLFxuICB0ZW1wbGF0ZTogYDwhLS1cbn4gQ29weXJpZ2h0IDIwMTgtcHJlc2VudCBPcGVuIE5ldHdvcmtpbmcgRm91bmRhdGlvblxuflxufiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xufiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5+IFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuflxufiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5+XG5+IFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbn4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxufiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbn4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxufiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbi0tPlxuPGRpdiBpZD1cIm1hc3QtdG9wLWJsb2NrXCI+PC9kaXY+XG48IS0tIFRoZSBtYXN0LXRvcC1ibG9jayBpcyBhbiBpbmxpbmUgZGlzcGxheSBlbGVtZW50IHRoYXQgcHVzaGVzIGFueVxuICBzdWJzZXF1ZW50IGVsZW1lbnRzIGRvd24gdGhlIHBhZ2UuIEl0IGhhcyBhIGhlaWdodCBvZiA0OHB4XG4gICAgIFRoZSBtYXN0IGJsb2NrIG92ZXJsYXlzIHRoZSBtYXN0LXRvcC1ibG9jay4gSXQgaXMgaXMgcG9zaXRpb25lZFxuICAgICBhYnNvbHV0ZWx5IHNvIHRoYXQgdGhlIG5hdiBjb21wb25lbnQgY2FuIHNsaWRlIGluIGJlaGluZCBpdCB3aGVuXG4gICAgIG5vdCBzaG93biAtLT5cbjxkaXYgaWQ9XCJtYXN0XCIgYWxpZ249XCJsZWZ0XCI+XG4gICAgPHNwYW4gY2xhc3M9XCJuYXYtbWVudS1idXR0b24gY2xpY2thYmxlXCIgKGNsaWNrKT1cIm5zLnRvZ2dsZU5hdigpXCI+XG4gICAgICAgIDxpbWcgc3JjPVwiZGF0YS9pbWcvbmF2LW1lbnUtbW9qby5wbmdcIi8+XG4gICAgPC9zcGFuPlxuICAgIDxpbWcgY2xhc3M9XCJsb2dvXCIgc3JjPVwiZGF0YS9pbWcvbWFzdGhlYWQtbG9nby1tb2pvLnBuZ1wiPlxuICAgIDxvbm9zLWNvbmZpcm0gdGl0bGU9XCJ7eyBsaW9uRm4oJ3VpX29rX3RvX3VwZGF0ZScpIH19XCIgbWVzc2FnZT1cInt7IGNvbmZpcm1NZXNzYWdlIH19XCIgd2FybmluZz1cInt7IHN0cm9uZ1dhcm5pbmcgfX1cIiAoY2hvc2VuKT1cImRPaygkZXZlbnQpXCI+PC9vbm9zLWNvbmZpcm0+XG4gICAgPGRpdiBpZD1cIm1hc3QtcmlnaHRcIj5cbiAgICAgICAgPG5hdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93bi1wYXJlbnRcIj5cbiAgICAgICAgICAgICAgICA8YSBjbGFzcz1cImNsaWNrYWJsZSB1c2VyLW1lbnVfX25hbWVcIj57eyB1c2VybmFtZSB9fSA8aSBjbGFzcz1cImRyb3Bkb3duLWljb25cIj48L2k+PC9hPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkcm9wZG93blwiPlxuICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwicnMvbG9nb3V0XCI+IHt7IGxpb25GbignbG9nb3V0JykgfX0gPC9hPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY3RybC1idG5zXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImFjdGl2ZSBjbGlja2FibGUgaWNvblwiIChjbGljayk9XCJkaXJlY3RUbygpXCI+XG4gICAgICAgICAgICAgICAgICAgIDxvbm9zLWljb24gaWNvbklkPVwicXVlcnlcIiBpY29uU2l6ZT1cIjMyXCIgdG9vbFRpcD1cInt7IGxpb25GbigndHRfaGVscCcpIH19XCI+PC9vbm9zLWljb24+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9uYXY+XG5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuYCxcbiAgc3R5bGVzOiBbYCNtYXN0LXRvcC1ibG9ja3tkaXNwbGF5OmJsb2NrO3otaW5kZXg6LTE7aGVpZ2h0OjQ4cHg7d2lkdGg6MTAwJX0jbWFzdHtwb3NpdGlvbjphYnNvbHV0ZTt3aWR0aDoxMDAlO3RvcDowO2hlaWdodDo0OHB4O3BhZGRpbmc6MDt6LWluZGV4OjEwMDAwfSNtYXN0IGE6aG92ZXJ7dGV4dC1kZWNvcmF0aW9uOm5vbmV9aHRtbFtkYXRhLXBsYXRmb3JtPWlQYWRdICNtYXN0e3BhZGRpbmctdG9wOjE2cHh9I21hc3QgLm5hdi1tZW51LWJ1dHRvbntkaXNwbGF5OmlubGluZS1ibG9jazt2ZXJ0aWNhbC1hbGlnbjptaWRkbGU7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6NDhweDtwYWRkaW5nOjAgMTJweDtjdXJzb3I6cG9pbnRlcjtjdXJzb3I6aGFuZDtmb250LXNpemU6MH0jbWFzdCAubmF2LW1lbnUtYnV0dG9uIGltZ3t3aWR0aDoyNXB4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZX0jbWFzdCAubG9nb3toZWlnaHQ6NDdweDt3aWR0aDo1MTFweDt2ZXJ0aWNhbC1hbGlnbjpib3R0b219I21hc3QtcmlnaHR7ZGlzcGxheTppbmxpbmUtYmxvY2s7ZmxvYXQ6cmlnaHQ7cG9zaXRpb246cmVsYXRpdmU7dG9wOjA7cGFkZGluZy1yaWdodDoxNXB4O2xpbmUtaGVpZ2h0OjQ4cHh9I21hc3QtcmlnaHQgZGl2LmN0cmwtYnRuc3tmbG9hdDpyaWdodH0jbWFzdC1yaWdodCBkaXYuaWNvbntib3gtc2l6aW5nOmJvcmRlci1ib3g7cG9zaXRpb246cmVsYXRpdmU7aGVpZ2h0OjQ4cHg7d2lkdGg6NDhweDtwYWRkaW5nOjlweH0jbWFzdCAuZHJvcGRvd24tcGFyZW50e3Bvc2l0aW9uOnJlbGF0aXZlO2Zsb2F0OnJpZ2h0fSNtYXN0IC5kcm9wZG93bi1wYXJlbnQgaS5kcm9wZG93bi1pY29ue2Rpc3BsYXk6aW5saW5lLWJsb2NrO2hlaWdodDo3cHg7d2lkdGg6OXB4O21hcmdpbi1sZWZ0OjEwcHg7YmFja2dyb3VuZDp1cmwoZGF0YS9pbWcvZHJvcGRvd24taWNvbi5wbmcpIG5vLXJlcGVhdH0jbWFzdCAuZHJvcGRvd257cG9zaXRpb246YWJzb2x1dGU7dG9wOjQwcHg7cmlnaHQ6LThweDtkaXNwbGF5Om5vbmU7bWluLXdpZHRoOjEwMHB4O2xpbmUtaGVpZ2h0OjE2cHg7Zm9udC1zaXplOjEycHQ7ei1pbmRleDoxMDAwfSNtYXN0IC5kcm9wZG93biBhe3RleHQtZGVjb3JhdGlvbjpub25lO2ZvbnQtc2l6ZToxMnB4O2Rpc3BsYXk6YmxvY2s7cGFkZGluZzo4cHggMTZweCA2cHggMTJweH0jbWFzdCAuZHJvcGRvd24tcGFyZW50OmhvdmVyIC5kcm9wZG93bntkaXNwbGF5OmJsb2NrfSNtYXN0IC5kcm9wZG93bi1wYXJlbnQ6aG92ZXIgaS5kcm9wZG93bi1pY29ue2JhY2tncm91bmQtcG9zaXRpb24teDotMTRweH1odG1sW2RhdGEtcGxhdGZvcm09aVBhZF0gI21hc3QgLmRyb3Bkb3due3RvcDo1N3B4fWAsIGAjbWFzdHtiYWNrZ3JvdW5kLWNvbG9yOiMyMzFmMjB9I21hc3QgLm5hdi1tZW51LWJ1dHRvbjpob3ZlcntiYWNrZ3JvdW5kLWNvbG9yOiM4ODh9I21hc3QgbmF2LCNtYXN0LXJpZ2h0IGF7Y29sb3I6IzAwOWZkYn0jbWFzdCAuZHJvcGRvd257YmFja2dyb3VuZC1jb2xvcjojMjMxZjIwO2JvcmRlcjoxcHggc29saWQgI2RkZH0jbWFzdCAuZHJvcGRvd24gYXtjb2xvcjojMDA5ZmRiO2JvcmRlci1ib3R0b206MXB4IHNvbGlkICM0NDR9I21hc3QgLmRyb3Bkb3duIGE6aG92ZXJ7Y29sb3I6I2ZmZn1gXVxufSlcbmV4cG9ydCBjbGFzcyBNYXN0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICAgIEBJbnB1dCgpIHVzZXJuYW1lOiBzdHJpbmc7XG5cbiAgICBsaW9uRm47IC8vIEZ1bmN0aW9uXG4gICAgdmlld01hcCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KFtdKTsgLy8gQSBtYXAgb2YgYXBwIG5hbWVzXG4gICAgY29uZmlybU1lc3NhZ2U6IHN0cmluZyA9ICcnO1xuICAgIHN0cm9uZ1dhcm5pbmc6IHN0cmluZyA9ICcnO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgbGlvbjogTGlvblNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbG9nOiBMb2dTZXJ2aWNlLFxuICAgICAgICBwdWJsaWMgbnM6IE5hdlNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgd3NzOiBXZWJTb2NrZXRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgICAgICBwcml2YXRlIHpvbmU6IE5nWm9uZSxcbiAgICAgICAgQEluamVjdCgnV2luZG93JykgcHJpdmF0ZSB3aW5kb3c6IGFueSxcbiAgICApIHtcbiAgICAgICAgdGhpcy52aWV3TWFwLnNldCgnYXBwcycsICdodHRwczovL3dpa2kub25vc3Byb2plY3Qub3JnL2Rpc3BsYXkvT05PUy9HVUkrQXBwbGljYXRpb24rVmlldycpO1xuICAgICAgICB0aGlzLnZpZXdNYXAuc2V0KCdkZXZpY2UnLCAnaHR0cHM6Ly93aWtpLm9ub3Nwcm9qZWN0Lm9yZy9kaXNwbGF5L09OT1MvR1VJK0RldmljZStWaWV3Jyk7XG4gICAgICAgIHRoaXMudmlld01hcC5zZXQoJycsICdodHRwczovL3dpa2kub25vc3Byb2plY3Qub3JnL2Rpc3BsYXkvT05PUy9UaGUrT05PUytXZWIrR1VJJyk7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmxpb24udWJlcmNhY2hlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5saW9uRm4gPSB0aGlzLmR1bW15TGlvbjtcbiAgICAgICAgICAgIHRoaXMubGlvbi5sb2FkQ2JzLnNldCgnbWFzdCcsICgpID0+IHRoaXMuZG9MaW9uKCkpO1xuICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ0xJT04gbm90IGF2YWlsYWJsZSB3aGVuIE1hc3RDb21wb25lbnQgaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZG9MaW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLndzcy5iaW5kSGFuZGxlcnMobmV3IE1hcDxzdHJpbmcsIChkYXRhKSA9PiB2b2lkPihbXG4gICAgICAgICAgICBbJ2d1aVJlbW92ZWQnLCAoZGF0YSkgPT4gdGhpcy50cmlnZ2VyUmVmcmVzaChkYXRhLCBmYWxzZSkgXSxcbiAgICAgICAgICAgIFsnZ3VpQWRkZWQnLCAoZGF0YSkgPT4gdGhpcy50cmlnZ2VyUmVmcmVzaChkYXRhLCB0cnVlKSBdXG4gICAgICAgIF0pKTtcbiAgICAgICAgdGhpcy5sb2cuZGVidWcoJ01hc3RDb21wb25lbnQgaW5pdGlhbGl6ZWQnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBOYXYgY29tcG9uZW50IHNob3VsZCBuZXZlciBiZSBjbG9zZWQsIGJ1dCBpbiBjYXNlIGl0IGRvZXMsIGl0J3NcbiAgICAgKiBzYWZlciB0byB0aWR5IHVwIGFmdGVyIGl0c2VsZlxuICAgICAqL1xuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLmxpb24ubG9hZENicy5kZWxldGUoJ21hc3QnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAqIFJlYWQgdGhlIExJT04gYnVuZGxlIGZvciBBcHAgYW5kIHNldCB1cCB0aGUgbGlvbkZuXG4gICAgKi9cbiAgICBkb0xpb24oKSB7XG4gICAgICAgIHRoaXMubGlvbkZuID0gdGhpcy5saW9uLmJ1bmRsZSgnY29yZS5mdy5NYXN0Jyk7XG4gICAgICAgIGlmICh0aGlzLnVzZXJuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXNlcm5hbWUgPSB0aGlzLmxpb25GbigndW5rbm93bl91c2VyJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAqIEEgZHVtbXkgaW1wbGVtZW50YXRpb24gb2YgdGhlIGxpb25GbiB1bnRpbCB0aGUgcmVzcG9uc2UgaXMgcmVjZWl2ZWQgYW5kIHRoZSBMSU9OXG4gICAgKiBidW5kbGUgaXMgcmVjZWl2ZWQgZnJvbSB0aGUgV2ViU29ja2V0XG4gICAgKi9cbiAgICBkdW1teUxpb24oa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gJyUnICsga2V5ICsgJyUnO1xuICAgIH1cblxuICAgIGRpcmVjdFRvKCkge1xuICAgICAgICBjb25zdCBjdXJJZCA9IHRoaXMud2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoJy8nLCAnJyk7XG4gICAgICAgIGxldCBoZWxwVXJsOiBzdHJpbmcgPSB0aGlzLnZpZXdNYXAuZ2V0KGN1cklkKTtcbiAgICAgICAgaWYgKGhlbHBVcmwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaGVscFVybCA9IHRoaXMudmlld01hcC5nZXQoJycpO1xuICAgICAgICAgICAgdGhpcy5sb2cud2FybignTm8gaGVscCBmaWxlIGxpbmtlZCBmb3IgdmlldzonLCBjdXJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy53aW5kb3cub3BlbihoZWxwVXJsKTtcbiAgICB9XG5cbiAgICB0cmlnZ2VyUmVmcmVzaChkYXRhOiBhbnksIGFkZGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY29uZmlybU1lc3NhZ2UgPSB0aGlzLmxpb25GbihhZGRlZCA/ICd1aWNvbXBfYWRkZWQnIDogJ3VpY29tcF9yZW1vdmVkJyk7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKCdSZWZyZXNoIGhhcyBiZWVuIHRyaWdnZXJlZCAtIGl0ZW0nLCBhZGRlZCA/ICdhZGRlZCcgOiAncmVtb3ZlZCcsICcgLSAnLCBkYXRhKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayB3aGVuIHRoZSBDb25maXJtIGRpYWxvZyBpcyBzaG93biBhbmQgYSBjaG9pY2UgaXMgbWFkZVxuICAgICAqL1xuICAgIGRPayhjaG9pY2U6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKGNob2ljZSkge1xuICAgICAgICAgICAgdGhpcy5ucy5nZXRVaVZpZXdzKCk7XG4gICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy8nXSk7XG4gICAgICAgICAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmxvZy5kZWJ1ZygnUmVmcmVzaCBjb25maXJtZWQnKTsgLy8gV2lsbCBub3QgYmUgcHJpbnRlZCBpZiBwYWdlIHJlbG9hZHNcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sb2cuZGVidWcoJ1JlZnJlc2ggY2FuY2VsbGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb25maXJtTWVzc2FnZSA9ICcnO1xuICAgICAgICB0aGlzLnN0cm9uZ1dhcm5pbmcgPSAnJztcbiAgICB9XG59XG4iXX0=